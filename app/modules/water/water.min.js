angular.module("app").component("water",{templateUrl:"app/modules/water/water.html?rev=d27873c23b",controller:["$scope","$api","$q","$interval","$timeout","$state","$stateParams","$element",function(e,t,a,l,o,i,n,p){$ctrl=this;var r=APP.Project[0]._id;n.index&&sessionStorage.setItem("waterPage",n.index);var s=n.index?n.index:sessionStorage.getItem("waterPage");$ctrl.paramsIndex={i:s,tit:s+"#  变电所",img:"/app/img/water/"+s+".png"};var u=new Date,c=u.getFullYear(),v=u.getMonth()+1<10?"0"+(u.getMonth()+1):u.getMonth()+1,d=u.getDate()<10?"0"+u.getDate():u.getDate(),m=u.getHours()<10?"0"+u.getHours():u.getHours(),f=String(c)+v+d,y=new Date(c+"-"+v+"-"+d+" "+m+":00:00").getTime();switch($ctrl.event1={page_1:[{type:"x",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"22%",left:"4%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"4.5%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"9.1%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"13.5%"},status:0},{type:"b",name:"",id:"71564013",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"18%",left:"26.4%"},status:0},{type:"b",name:"",id:"71564007",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"38.6%",left:"26.4%"},status:0},{type:"b",name:"",id:"79234140",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"59.4%",left:"26.4%"},status:0},{type:"d",name:"",id:"79304013",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"18%",left:"52.8%"},status:0},{type:"d",name:"",id:"79304028",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"38.7%",left:"52.8%"},status:0},{type:"d",name:"",id:"79304019",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"59.4%",left:"52.8%"},status:1},{type:"b",name:"",id:"71564012",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"18%",left:"61.8%"},status:0},{type:"b",name:"",id:"79234133",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"61.8%"},status:0},{type:"d",name:"",id:"71564015",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"18%",left:"88.7%"},status:0},{type:"d",name:"",id:"79234136",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"88.7%"},status:0}]},$ctrl.event2={page_1:[{type:"x",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"22%",left:"4%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"4.5%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"9.1%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"13.5%"},status:0},{type:"b",name:"",id:"79304031",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"18%",left:"26.5%"},status:0},{type:"b",name:"",id:"79304005",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"33.6%",left:"26.5%"},status:0},{type:"b",name:"",id:"79304023",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"26.5%"},status:0},{type:"b",name:"",id:"73065376",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"64.5%",left:"26.5%"},status:0},{type:"d",name:"",id:"77215407",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"18%",left:"52.8%"},status:0},{type:"d",name:"",id:"77215397",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"64.5%",left:"52.8%"},status:1},{type:"b",name:"",id:"73065174",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"18%",left:"61.8%"},status:0},{type:"b",name:"",id:"73065171",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"33.5%",left:"61.8%"},status:0},{type:"b",name:"",id:"73085122",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"61.8%"},status:0},{type:"b",name:"",id:"73085108",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"64.5%",left:"61.8%"},status:0},{type:"d",name:"",id:"73065378",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"88.5%"},status:0}]},$ctrl.event3={page_1:[{type:"x",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"22%",left:"4%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"4.5%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"9.1%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"13.5%"},status:0},{type:"b",name:"",id:"79234134",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"26.4%"},status:0},{type:"d",name:"",id:"73065175",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"52.8%"},status:0},{type:"b",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"62%"},status:0},{type:"d",name:"",id:"79304014",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"89%"},status:0}]},$ctrl.event4={wdId1:"330200A01343000000000024024014",wdId2:"330200A01343000000000033023014",page_1:[{type:"x",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"22%",left:"4%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"4.5%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"9.1%"},status:0},{type:"s",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"60%",left:"13.5%"},status:0},{type:"b",name:"",id:"78024745",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"17.9%",left:"26.4%"},status:0},{type:"b",name:"",id:"78024701",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"33.5%",left:"26.4%"},status:0},{type:"b",name:"",id:"78024705",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"26.4%"},status:0},{type:"b",name:"",id:"78024704",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"64.7%",left:"26.4%"},status:0},{type:"d",name:"",id:"73065174",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"17.9%",left:"52.3%"},status:0},{type:"d",name:"",id:"73065171",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"33.6%",left:"52.3%"},status:0},{type:"d",name:"",id:"73085122",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"52.3%"},status:1},{type:"d",name:"",id:"73085108",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"64.6%",left:"52.3%"},status:1},{type:"b",name:"",id:"78024750",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"17.9%",left:"62.3%"},status:0},{type:"b",name:"",id:"78024710",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"33.6%",left:"62.3%"},status:0},{type:"b",name:"",id:"78024705",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"62.3%"},status:0},{type:"b",name:"",id:"78024704",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"64.6%",left:"62.3%"},status:0},{type:"d",name:"",id:"77215404",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"17.9%",left:"88.7%"},status:0},{type:"d",name:"",id:"77215386",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"33.6%",left:"88.7%"},status:0},{type:"d",name:"",id:"78024737",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"49%",left:"88.7%"},status:0},{type:"d",name:"",id:"78024739",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"64.6%",left:"88.7%"},status:0}]},$ctrl.event5={wdId1:"330200A01343000000000024024014",wdId2:"330200A01343000000000033023014",page_1:[{type:"b",name:"",id:"",flow:"",velocity:"",temperature:"",value:"0.0",position:{top:"35.4%",left:"44.7%"},status:0}]},s){case"1-H-1":$ctrl.event=$ctrl.event1;break;case"1-H-2":$ctrl.event=$ctrl.event2;break;case"1-H-3":$ctrl.event=$ctrl.event3;break;case"111-111":$ctrl.event=$ctrl.event4;break;case"1":$ctrl.event=$ctrl.event5;break;case 6:$ctrl.event=$ctrl.event6;break;case 7:$ctrl.event=$ctrl.event7;break;case 8:$ctrl.event=$ctrl.event8;break;case 9:$ctrl.event=$ctrl.event9;break;case 10:$ctrl.event=$ctrl.event10;break;case 11:$ctrl.event=$ctrl.event11;break;case 12:$ctrl.event=$ctrl.event12;break;case 13:$ctrl.event=$ctrl.event13;break;case 14:case 15:$ctrl.event=$ctrl.event15;break;case 16:$ctrl.event=$ctrl.event16;break;default:$ctrl.event=""}$ctrl.event.page_1,$ctrl.event.page_2;$ctrl.eventPage="",$ctrl.getS=function(e){$ctrl.eventPage=e,$ctrl.pageIndex=0,$ctrl.pageIndex2=0;for(var a=0;a<e.length;a++)e[a].id?t.business.monitor({devicetype:"ULTRACOLDWATERMETER",project:r,key:e[a].id,ext:{enableMask:1},mode:"SENSOR"},function(t){var a=t.result[r].detail[0];e[$ctrl.pageIndex].data=a,a?(e[$ctrl.pageIndex].name=a.title,!0===a.status?e[$ctrl.pageIndex].status=a.status:e[$ctrl.pageIndex].status=0,e[$ctrl.pageIndex].flow=a.channels["04"].lasttotal,e[$ctrl.pageIndex].velocity=a.channels["05"].lasttotal+" m³/h",e[$ctrl.pageIndex].temperature=a.channels["09"].lasttotal+" ℃",e[$ctrl.pageIndex].vauleId=a.channels["04"].id):e[$ctrl.pageIndex].status=1,$ctrl.pageIndex++}).$promise.then(function(){t.business.channeldetail({id:e[$ctrl.pageIndex2].vauleId,timeformat:"DAY",from:f,to:f},function(t){null==t.result.detail[y].value?e[$ctrl.pageIndex2].vaule="0.0":e[$ctrl.pageIndex2].value=t.result.detail[y].value,$ctrl.pageIndex2++})}):(e[$ctrl.pageIndex].status=1,$ctrl.pageIndex++,$ctrl.pageIndex2++)}}]}),angular.module("app").component("channeldetail",{templateUrl:"app/modules/water/waterHighcharts.html?rev=00dbf4e282",bindings:{curve:"=",channels:"<"},controller:["$scope","$element","$api","$timeout",function(e,t,a,l){var o=this;t.find(".modal-curve").on("shown.bs.modal",function(){l(o.buildLine)}).on("hidden.bs.modal",function(){delete o.curve,delete o.timeline}),$ctrl.apiFun=function(e){o.api=e,o.channeldetail(o.api)},o.queryBtn=function(){o.channeldetail(o.api)},o.date=moment().format("YYYY-MM-DD"),o.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},o.timetype_current="DAY",o.timetypeChange=function(e){o.timetype_current=e,o.channeldetail(o.api)},o.currentchannelid="04",o.changeId=function(e){o.currentchannelid=e,o.channeldetail(o.api)},o.channeldetail=function(e){o.type=o.type||"diff",o.categories=[],o.diff=[],o.scale=[],o.enable=!1,o.channelID=[],o.charttype="spline",o.title=e.title,a.business.channeldetail({id:e.channels[o.currentchannelid].id,timeformat:o.timetype_current,from:o.date.replace(/-/g,""),to:o.date.replace(/-/g,"")},function(e){if(e.result){for(index in e.result.detail)o.categories.push(e.result.detail[index].timepoint),o.diff.push(e.result.detail[index].value),o.scale.push(e.result.detail[index].total);o.unit=e.result.unit,o.buildLine()}})},o.lineType=function(e){o.type=e,o.buildLine()},o.typeChange=function(e){o.charttype=e,o.buildLine()},o.buildLine=function(){o.timeline={chart:{type:o.charttype},title:!1,xAxis:{type:"datetime",categories:o.categories,labels:{formatter:function(){return moment(this.value).format({DAY:"H",WEEK:"M-DD",MONTH:"M-DD",YEAR:"YYYY-MM"}[o.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} '+o.unit+"</span>"},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"+o.unit}}},series:[{name:o.title,data:o[o.type]}]}}}]});