angular.module("app").component("system",{templateUrl:"app/modules/system/system.html?rev=056cba0922",controller:["$api","$q","$interval","$state","$timeout",function(t,e,r,a,l){$ctrl=this;var n=[],g=new Date;t.eca.info({projectid:APP.Project[0]._id,type:"BYCATEGORY"},function(t){angular.forEach(t.result,function(t){n.push(t.id)})}).$promise.then(function(){t.eca.analysis({nodes:n,projectid:APP.Project[0]._id,timefrom:String(g.getFullYear())+(g.getMonth()>8&&String(g.getMonth()+1)||"0"+String(g.getMonth()+1))+(g.getDate()>9&&String(g.getDate())||"0"+String(g.getDate())),timeto:String(g.getFullYear())+(g.getMonth()>8&&String(g.getMonth()+1)||"0"+String(g.getMonth()+1))+(g.getDate()>9&&String(g.getDate())||"0"+String(g.getDate())),timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"MELECTRICITYMETER"==t.category&&($ctrl.ele=t),"ULTRACOLDWATERMETER"==t.category&&($ctrl.water=t)}),$ctrl.maxele=0,$ctrl.maxwater=0,angular.forEach($ctrl.ele.data.usage,function(t){$ctrl.maxele<t&&($ctrl.maxele=t)}),angular.forEach($ctrl.water.data.usage,function(t){$ctrl.maxwater<t&&($ctrl.maxwater=t)}),$ctrl.percapitaele=$ctrl.ele.data.usagesum/$ctrl.ele.formula.variables.PERSON,$ctrl.percapitawater=$ctrl.water.data.usagesum/$ctrl.water.formula.variables.PERSON}).$promise.then(function(){t.business.monthlykgce({time:String(g.getFullYear())+(g.getMonth()>8&&String(g.getMonth()+1)||"0"+String(g.getMonth()+1)),project:APP.Project[0]._id},function(e){$ctrl.energy={},$ctrl.energy.monthusage=e.result[APP.Project[0]._id].kwh,$ctrl.energy.monthaverage=e.result[APP.Project[0]._id].kwh/e.result[APP.Project[0]._id].buildingarea,$ctrl.ele.monthaverage=$ctrl.ele.data.usagesum/e.result[APP.Project[0]._id].buildingarea,$ctrl.water.monthaverage=$ctrl.water.data.usagesum/e.result[APP.Project[0]._id].buildingarea,t.business.monthlykgce({time:String(0==g.getMonth()&&g.getFullYear()-1||g.getFullYear())+(0==g.getMonth()&&"12"||g.getMonth()>9&&String(g.getMonth())||"0"+String(g.getMonth())),project:APP.Project[0]._id},function(t){$ctrl.energy.persent=0!=t.result[APP.Project[0]._id].kwh&&($ctrl.energy.monthusage-t.result[APP.Project[0]._id].kwh)/t.result[APP.Project[0]._id].kwh||100})}),t.eca.analysis({nodes:n,projectid:APP.Project[0]._id,timefrom:String(0==g.getMonth()&&g.getFullYear()-1||g.getFullYear())+(0==g.getMonth()&&"12"||g.getMonth()>9&&String(g.getMonth())||"0"+String(g.getMonth()))+(g.getDate()>9&&String(g.getDate())||"0"+String(g.getDate())),timeto:String(0==g.getMonth()&&g.getFullYear()-1||g.getFullYear())+(0==g.getMonth()&&"12"||g.getMonth()>9&&String(g.getMonth())||"0"+String(g.getMonth()))+(g.getDate()>9&&String(g.getDate())||"0"+String(g.getDate())),timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"MELECTRICITYMETER"==t.category&&($ctrl.elelast=t),"ULTRACOLDWATERMETER"==t.category&&($ctrl.waterlast=t)}),$ctrl.ele.persent=0!=$ctrl.elelast.data.usagesum&&($ctrl.ele.data.usagesum-$ctrl.elelast.data.usagesum)/$ctrl.elelast.data.usagesum||100,$ctrl.water.persent=0!=$ctrl.waterlast.data.usagesum&&($ctrl.water.data.usagesum-$ctrl.waterlast.data.usagesum)/$ctrl.waterlast.data.usagesum||100})})})}]});