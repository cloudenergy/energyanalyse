angular.module("app").component("analyse",{templateUrl:"app/modules/analyse/analyse.html?rev=56a771c36d",controller:["$api","$scope","$rootScope","$state","$q","$stateParams","$timeout",function(e,t,a,n,l,i,o){function r(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),n=t.getMonth()+1,l=t.getDate()<=9&&"0"+t.getDate()||t.getDate();return String(a)+String(n<10&&"0"+n||n)+String(l)}var s,u,m,d=this,y="DAY";d.analyseTimeselected="today",("BYITEM"==i.datatype||!i.datatype)&&(d.devicedisable=!0),d.today=r(0),d.yesterday=r(-1),d.beforeyesterday=r(-2),d.beforelastMonth=String((new Date).getMonth()-1<=0?(new Date).getFullYear()-1:(new Date).getFullYear())+(1==String(Number((new Date).getMonth()+1)-2).length&&"0"+String(Number((new Date).getMonth()+1)-2)||String((new Date).getMonth()+1-2)),d.lastMonth=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth())),d.thisMonth=String((new Date).getFullYear())+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),d.year=String((new Date).getFullYear()),d.lastyear=String((new Date).getFullYear()-1),d.beforelastyear=String((new Date).getFullYear()-2),s=d.today,d.startDate=d.endDate=String((new Date).getFullYear())+"-"+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+"-"+(+(new Date).getDate()<=9&&"0"+(new Date).getDate()||(new Date).getDate()),d.energyselected=["ELECTRICITYMETER","MELECTRICITYMETER"],d.title="耗电量",d.unit="kwh",d.device=["ELECTRICITYMETER","MELECTRICITYMETER"],d.more=[{key:"HOTWATERMETER",title:"热水表",unit:"m3"},{key:"TEMPERATURECONTROL",title:"温控器",unit:"m3"},{key:"TTYPETEMPCONTROL",title:"T型温控器",unit:"m3"},{key:"DDWATERMETER",title:"直饮水表",unit:"m3"},{key:"ULTRACOLDWATERMETER",title:"超声波水表",unit:"m3"},{key:"PRESSUREMETER",title:"压力表",unit:"Pa"},{key:"OXYGENMETER",title:"氧气表",unit:"m3"}],d.analyseType=[{title:"分项能耗",key:"BYITEM",href:'dashboard.analyse({datatype:"BYITEM"})'},{title:"部门能耗",key:"BYAPART",href:'dashboard.analyse({datatype:"BYAPART"})'},{title:"区域能耗",key:"CUSTOMER",href:'dashboard.analyse({datatype:"CUSTOMER"})'}],d.energy=[{title:"电",key:["ELECTRICITYMETER","MELECTRICITYMETER"],unit:"kwh",name:"耗电量"},{title:"水",key:["COLDWATERMETER","HOTWATERMETER","ULTRACOLDWATERMETER"],unit:"m3",name:"用水量"},{title:"空调",key:"hotcloddata",unit:"kwh",name:"冷/热量"},{title:"费用",key:"FEE"}],d.analyseTime=[{title:"日",key:"today"},{title:"月",key:"month"},{title:"年",key:"year"}],d.analyseTypeSelected=i.datatype||"BYITEM",d.export=function(){d.gridOptions.exporterCsvFilename=document.title+"_能耗分析_"+moment().format("YYYYMMDDHHmmss")+".csv",d.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},e.eca.info({node:d.customerSelected,projectid:APP.Project[0]._id,type:i.datatype||"BYITEM"},function(e){var t=e.result;d.categoryArray=[],angular.forEach(t,function(e){d.categoryArray.push(e.id)})}).$promise.then(function(){d.device=["ELECTRICITYMETER","MELECTRICITYMETER"],d.unit="kwh",d.title="耗电量",d.initialize=function(t){var n=l.defer(),i=[];return timeparams=t||"today",i.push(e.eca.analysis({nodes:d.customerSelected&&d.customerSelected||d.categoryArray,projectid:APP.Project[0]._id,timefrom:s,timeto:s,devicetype:d.devicetype,detail:!0,timetype:y||"DAY"},function(e){angular.forEach(e.result,function(e){e.stack="today"}),d.cachedata=e,d.origindata=angular.copy(e)}).$promise),l.all(i).then(function(){d.getpie(["ELECTRICITYMETER","MELECTRICITYMETER"],"kwh","耗电量"),d.chartdata=d.ELECTRICITYMETER[a.type],d.unit||(d.unit="kwh"),d.chartTitle||(d.chartTitle="耗电量"),d.coldhot={},d.hotcloddata={usage:{today:{},yesterday:{},beforeyesterday:{}},cost:{today:{},yesterday:{},beforeyesterday:{}}},d.fee={today:{},yesterday:{},beforeyesterday:{}},angular.forEach(d.category,function(e){d.todaycost=new BigDecimal(String(e.todaycost)).add(new BigDecimal(String(d.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),d.yesterdaycost=new BigDecimal(String(e.yesterdaycost)).add(new BigDecimal(String(d.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),d.beforeyesterdaycost=new BigDecimal(String(e.beforeyesterdaycost)).add(new BigDecimal(String(d.beforeyesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),d.coldhot.today=new BigDecimal(String(d.category.HEATENERGYMETER&&d.category.HEATENERGYMETER.today||0)).add(new BigDecimal(String(d.category.ENERGYMETER&&d.category.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),d.coldhot.yesterday=new BigDecimal(String(d.category.HEATENERGYMETER&&d.category.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(d.category.ENERGYMETER&&d.category.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),d.coldhot.beforeyesterday=new BigDecimal(String(d.category.HEATENERGYMETER&&d.category.HEATENERGYMETER.beforeyesterday||0)).add(new BigDecimal(String(d.category.ENERGYMETER&&d.category.ENERGYMETER.beforeyesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()}),angular.forEach(!angular.equals({},d.TIMERMETER.usage.today)&&d.TIMERMETER.usage||!angular.equals({},d.HEATENERGYMETER.usage.today)&&d.HEATENERGYMETER.usage||!angular.equals({},d.ENERGYMETER.usage.today)&&d.ENERGYMETER.usage,function(e,t){"beforeyesterday"==t&&angular.forEach(e,function(e,t){d.hotcloddata.usage.beforeyesterday[t]={},d.hotcloddata.usage.beforeyesterday[t].timepoint=Number(t),d.hotcloddata.usage.beforeyesterday[t].value=Number(new BigDecimal(String(!angular.equals({},d.TIMERMETER.usage.beforeyesterday)&&d.TIMERMETER.usage.beforeyesterday[t].value||0)).add(new BigDecimal(String(!angular.equals({},d.HEATENERGYMETER.usage.beforeyesterday)&&d.HEATENERGYMETER.usage.beforeyesterday[t].value||0))).add(new BigDecimal(String(!angular.equals({},d.ENERGYMETER.usage.beforeyesterday)&&d.ENERGYMETER.usage.beforeyesterday[t].value||0))).setScale(2,MathContext.ROUND_HALF_UP).toString())})}),angular.forEach(d,function(e){angular.equals({},e.cost)||angular.forEach(e.cost,function(e,t){"today"==t&&angular.forEach(e,function(e,t){!d.fee.today[t]&&(d.fee.today[t]={}),d.fee.today[t].timepoint=Number(t),d.fee.today[t].value=Number(new BigDecimal(String(d.fee.today[t].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"yesterday"==t&&angular.forEach(e,function(e,t){!d.fee.yesterday[t]&&(d.fee.yesterday[t]={}),d.fee.yesterday[t].timepoint=Number(t),d.fee.yesterday[t].value=Number(new BigDecimal(String(d.fee.yesterday[t].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"beforeyesterday"==t&&angular.forEach(e,function(e,t){!d.fee.beforeyesterday[t]&&(d.fee.beforeyesterday[t]={}),d.fee.beforeyesterday[t].timepoint=Number(t),d.fee.beforeyesterday[t].value=Number(new BigDecimal(String(d.fee.beforeyesterday[t].value||0)).add(new BigDecimal(String(e.cost))).toString())})})}),("DAY"==y||angular.isUndefined(y))&&(a.tips={todayELECTRICITYMETER:d.category.ELECTRICITYMETER.today,yesterdayELECTRICITYMETER:d.category.ELECTRICITYMETER.yesterday,beforeyesterdayELECTRICITYMETER:d.category.ELECTRICITYMETER.beforeyesterday,todayCOLDWATERMETER:d.category.COLDWATERMETER.today,yesterdayCOLDWATERMETER:d.category.COLDWATERMETER.yesterday,beforeyesterdayCOLDWATERMETER:d.category.COLDWATERMETER.beforeyesterday,todaycoldhot:d.coldhot.today,yesterdaycoldhot:d.coldhot.today.yesterday,beforeyesterdaycoldhot:d.coldhot.today.beforeyesterday,todaycost:d.todaycost,yesterdaycost:d.yesterdaycost,beforeyesterdaycost:d.beforeyesterdaycost})}),n.resolve(),n.promise},t.$watch("$ctrl.customerSelected",function(e){d.device=void 0,d.unit=void 0,d.getdevicedata()})}),d.lastMonthdata=function(){e.eca.analysis({nodes:d.customerSelected&&d.customerSelected||d.categoryArray,projectid:APP.Project[0]._id,timefrom:String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),timeto:String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),devicetype:d.devicetype,detail:!0,timetype:y||"DAY"},function(e){d.datacopy=d.origindata.result,angular.forEach(e.result,function(e){e.stack="lastmouth",e.title=e.title+"(上月同期)",d.datacopy.push(e)}),d.cachedata.result=d.datacopy})},d.lastYeardata=function(){e.eca.analysis({nodes:d.customerSelected&&d.customerSelected||d.categoryArray,projectid:APP.Project[0]._id,timefrom:String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),timeto:String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),devicetype:d.devicetype,detail:!0,timetype:y||"DAY"},function(e){d.datacopy=d.origindata.result,angular.forEach(e.result,function(e){e.stack="lastmouth",e.title=e.title+"(去年同期)",d.datacopy.push(e)}),d.cachedata.result=d.datacopy})},d.gridOptions={onRegisterApi:function(e){d.gridApi=e},rowHeight:34,infiniteScrollDown:!0,enableColumnMenus:!1,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,t,a,n){return{name:!0,addr:!0,title:!0,time:!0}[a.field]?'="'+(n||"")+'"':n}},d.columnDefsData=function(){d.gridOptions.rowHeight=45,"DAY"==y?d.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"00:00",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"01:00",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02:00",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03:00",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04:00",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05:00",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06:00",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07:00",name:"hour7",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08:00",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09:00",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10:00",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11:00",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12:00",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13:00",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14:00",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15:00",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16:00",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17:00",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18:00",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19:00",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20:00",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21:00",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22:00",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23:00",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]:"MONTH"==y?d.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"01",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"24",name:"hour24",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"25",name:"hour25",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"26",name:"hour26",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"27",name:"hour27",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"28",name:"hour28",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"29",name:"hour29",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"30",name:"hour30",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"31",name:"hour31",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]:"YEAR"==y&&(d.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"2018",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2019",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2020",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2021",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2022",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2023",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2024",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2025",name:"hour7",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2026",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2027",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2028",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2029",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}])},d.getpie=function(e,t,a){d.piedata={},d.gridOptions.data=[],d.pieunit={title:a||d.title,unit:t||d.unit},d.device&&angular.forEach(d.cachedata.result,function(e){var t={},a=0;t.name=e.title,!e.data||null!=!e.data.usage&&angular.equals({},e.data.usage)||(angular.forEach(e.data.usage,function(e){t["hour"+a]=angular.isDefined(e.value)&&e.value||"0",a++}),d.gridOptions.data.push(t),d.piedata[e.title]=e.data&&e.data.usagesum||0||0)}),x=0,!d.device&&angular.forEach(d.cachedata.result,function(e){var t={},a=0;t.name=e.title,!e.data||null!=!e.data.cost&&angular.equals({},e.data.cost)||(x++,angular.forEach(e.data.cost,function(e){t["hour"+a]=angular.isDefined(e.cost)&&e.cost||"0",a++}),d.gridOptions.data.push(t),d.piedata[e.title]=e.data&&(e.data.costsum||0)||0)}),d.columnDefsData()},d.getdevicedata=function(e,t,n){d.energyselected=e||["ELECTRICITYMETER","MELECTRICITYMETER"],"FEE"!==e&&"hotcloddata"!==e&&(d.devicetype=e),d.device=e||["ELECTRICITYMETER","MELECTRICITYMETER"],"FEE"!==d.energyselected?(d.unit=t||"kwh",d.title=n||"耗电量",d.chartTitle=n||"耗电量"):(d.unit="元",d.title="费用",d.chartTitle=" 费用"),"hotcloddata"===e&&(d.device=["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],d.devicetype=["TIMERMETER","HEATENERGYMETER","ENERGYMETER"]),"FEE"!==d.energyselected&&d.initialize(d.analyseTimeselected).finally(function(){d.chartdata=d[e][a.type],"hotcloddata"===e?d.getpie(["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],t,n):d.getpie(d.device,d.unit,d.title)}),console.log(d.energyselected)},d.getfeedata=function(){d.switch="cost",d.unit="元",d.device=void 0,d.title=d.chartTitle="费用",d.getpie(void 0,"元","总费用")},d.redata=function(){d.ELECTRICITYMETER={},d.COLDWATERMETER={},d.HOTWATERMETER={},d.HEATENERGYMETER={},d.TEMPERATURECONTROL={},d.TIMERMETER={},d.PRESSUREMETER={},d.ULTRACOLDWATERMETER={},d.DDWATERMETER={},d.ENERGYMETER={},d.TTYPETEMPCONTROL={},d.OXYGENMETER={},d.category={}},d.customdate=function(){d.redata(),"MONTH"==y?(s=d.startDate.split("-")[0]+d.startDate.split("-")[1],u=d.endDate.split("-")[0]+d.endDate.split("-")[1]):"YEAR"==y?(s=d.startDate.split("-")[0],u=d.endDate.split("-")[0]):(s=d.startDate.split("-")[0]+d.startDate.split("-")[1]+d.startDate.split("-")[2],u=d.endDate.split("-")[0]+d.endDate.split("-")[1]+d.endDate.split("-")[2]),d.getdevicedata(d.device,d.unit,d.title)},d.gettimedata=function(e){d.same=d.circle=!1,d.analyseTimeselected=e,"today"==e?(d.redata(),s=d.today,m=d.beforeyesterday,y="DAY"):"month"==e?(d.redata(),s=d.thisMonth,m=d.beforelastMonth,y="MONTH"):"year"==e&&(d.redata(),s=d.year,m=d.beforelastyear,y="YEAR"),d.getdevicedata(d.device,d.unit,d.title)}}]}),angular.module("app").component("ele",{templateUrl:"app/modules/analyse/ele.html?rev=fbb71134c8",bindings:{cost:"=",data:"<",unit:"=",timetype:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$timeout",function(e,t,a,n){var l=this;e.$watch(function(){return l.cost},function(){var e=[];l.series=[],l.unit="元",l.data&&angular.forEach(l.data.result,function(t,a,n){if(t.data&&!angular.equals(t.data.cost,{})){var i={name:"",data:[],stack:""};i.stack=t.stack,angular.forEach(t.data.cost,function(a){i.name=t.title,e.push(a.timepoint),i.data.push(a.cost)}),l.series.push(i),e=e.unique1()}var o=["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"];angular.forEach(o,function(e,t){l.series[t]&&(l.series[t].color=e)})}),l.cost=void 0,l.typeChange()}),e.$watchCollection(function(){return l.data},function(e){var t=[];l.series=[],l.charttype="column",l.timetype=l.timetype||(l.timetype="today"),Array.prototype.unique1=function(){for(var e=[this[0]],t=1;t<this.length;t++){for(var a=!1,n=0;n<e.length;n++)if(this[t]==e[n]){a=!0;break}a||e.push(this[t])}return e},l.data&&angular.forEach(l.data.result,function(e,a,n){if(e.data&&!angular.equals(e.data.usage,{})){var i={name:"",data:[],stack:""};i.stack=e.stack,angular.forEach(e.data.usage,function(a){i.name=e.title,t.push(a.timepoint),i.data.push(a.value)}),l.series.push(i),t=t.unique1()}var o=["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"];angular.forEach(o,function(e,t){l.series[t]&&(l.series[t].color=e)})}),l.typeChange=function(e){e&&(l.charttype=e),l.energyconstitute={chart:{type:l.charttype,height:"520",backgroundColor:"rgba(0, 0, 0, 0)"},title:!1,xAxis:{type:"datetime",categories:t,labels:{formatter:function(){return"today"==l.timetype?moment(this.value).format("HH:ss"):"month"==l.timetype?moment(this.value).format("M-DD"):"year"==l.timetype?moment(this.value).format("YYYY-MM"):void 0},style:{color:"#000"}}},yAxis:{title:!1,labels:{style:{color:"#000"}}},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:black;font-weight:700;">{point.y} '+l.unit+"</span>"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,style:{color:"#000"}}}},legend:{itemStyle:{color:"#000"},maxHeight:40,navigation:{activeColor:"#3E576F",animation:!0,arrowSize:12,inactiveColor:"#CCC",style:{float:"right",fontWeight:"bold",color:"#333",fontSize:"12px"}}},series:l.series,exporting:{enabled:!1}}},l.typeChange()})}]}),angular.module("app").component("pie",{templateUrl:"app/modules/analyse/pie.html?rev=2f73e52508",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$timeout",function(e,t,a,n){var l=this;e.$watchCollection(function(){return l.data},function(){data=l.data||{};var e=0;l.unit||(l.unit={title:"总耗电量",unit:"kwh"}),angular.forEach(data,function(t,a){this.push([a,t]),e=Number(new BigDecimal(String(e)).add(new BigDecimal(String(t))).toString())},data=[]),l.dailysensordetail={chart:{style:{textAlign:"left"},height:"520",backgroundColor:"rgba(0, 0, 0, 0)",type:"pie"},title:{text:'<div class="pieTitle" style="font-size:16px;">'+l.unit.title+'</div><div style="color:#000;margin-top:5px;font-size:24px;">'+e+"</div>",verticalAlign:"middle",useHTML:!0,y:-45},tooltip:{pointFormat:"<b>{point.y:.2f}</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"80%",showInLegend:!0,size:"80%"}},legend:{itemStyle:{color:"#000",fontSize:"12px"},labelFormatter:function(){var e=Math.round(10*this.percentage)/10+"% "+this.name,t=Math.round(100*(this.y||0))/100;return['<span class="center-block" title="'+e+'">'+e+"</span>",'<span class="center-block text-muted" title="'+t+'">'+t+"</span>"].join("")},maxHeight:40,useHTML:!0,navigation:{activeColor:"#3E576F",animation:!0,arrowSize:12,inactiveColor:"#CCC",style:{fontWeight:"bold",color:"#333",fontSize:"12px",align:"right",x:"200",marginLeft:"20"}}},series:[{cropThreshold:0,turboThreshold:0,innerSize:"60%",data:data,colors:["#24CBE5","#FF9655","#FFF263","#6AF9C4","#64E572"]}],exporting:{enabled:!1}}})}]});