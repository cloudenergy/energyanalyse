angular.module("app").component("analyse",{templateUrl:"app/modules/analyse/analyse.html?rev=6b977c7290",controller:["$api","$scope","$rootScope","$state","$q",function(e,a,t,o,E){function s(e){var a=new Date;a.setDate(a.getDate()+e);var t=a.getFullYear(),o=a.getMonth()+1,E=a.getDate();return String(t)+String(o<10&&"0"+o||o)+String(E)}var r,n,l,T=this,R="DAY";T.today=s(0),T.yesterday=s(-1),T.beforeyesterday=s(-2),T.beforelastMonth=String((new Date).getMonth()-1<=0?(new Date).getFullYear()-1:(new Date).getFullYear())+(1==String(Number((new Date).getMonth()+1)-2).length&&"0"+String(Number((new Date).getMonth()+1)-2)||String((new Date).getMonth()+1-2)),T.lastMonth=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth())),T.thisMonth=String((new Date).getFullYear())+(1==((new Date).getMonth()+1).length&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),T.year=String((new Date).getFullYear()),T.lastyear=String((new Date).getFullYear()-1),T.beforelastyear=String((new Date).getFullYear()-2),r=T.today,n=T.yesterday,l=T.beforeyesterday,T.more=[{key:"HOTWATERMETER",title:"热水表",unit:"t"},{key:"TEMPERATURECONTROL",title:"温控器",unit:"m3"},{key:"TTYPETEMPCONTROL",title:"T型温控器",unit:"m3"},{key:"DDWATERMETER",title:"直饮水表",unit:"t"},{key:"ULTRACOLDWATERMETER",title:"超声波水表",unit:"t"},{key:"PRESSUREMETER",title:"压力表",unit:"Pa"},{key:"OXYGENMETER",title:"氧气表",unit:"m3"}],T.analyseType=[{title:"分项能耗",key:"BYITEM",href:'dashboard.else({datatype:"BYITEM"})'},{title:"区域能耗",key:"CUSTOMER",href:'dashboard.else({datatype:"CUSTOMER"})'},{title:"部门能耗",key:"BYAPART",href:'dashboard.else({datatype:"BYAPART"})'}],T.analyseTime=[{title:"今日",key:"today"},{title:"本月",key:"month"},{title:"本年",key:"year"}],e.eca.info({projectid:APP.Project[0]._id,type:"BYCATEGORY"},function(e){var a=e.result;T.categoryArray=[],angular.forEach(a,function(e){T.categoryArray.push(e.id)})}).$promise.then(function(){T.device="ELECTRICITYMETER",T.unit="kwh",T.title="耗电量",T.initialize=function(a){var o=[];"today"==(a=a||"today")?(T.ELECTRICITYMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.COLDWATERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.HOTWATERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.HEATENERGYMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.TEMPERATURECONTROL={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.TIMERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.PRESSUREMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.ULTRACOLDWATERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.DDWATERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.ENERGYMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.TTYPETEMPCONTROL={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.OXYGENMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},T.category={},o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:r,timeto:r,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.today=e.data.usage,T.ELECTRICITYMETER.cost.today=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.today=e.data.usage,T.COLDWATERMETER.cost.today=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.today=e.data.usage,T.HOTWATERMETER.cost.today=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.today=e.data.usage,T.HEATENERGYMETER.cost.today=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.today=e.data.usage,T.TEMPERATURECONTROL.cost.today=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.today=e.data.usage,T.TIMERMETER.cost.today=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.today=e.data.usage,T.PRESSUREMETER.cost.today=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.today=e.data.usage,T.ULTRACOLDWATERMETER.cost.today=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.today=e.data.usage,T.DDWATERMETER.cost.today=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.today=e.data.usage,T.ENERGYMETER.cost.today=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.today=e.data.usage,T.TTYPETEMPCONTROL.cost.today=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.today=e.data.usage,T.OXYGENMETER.cost.today=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].today=e.data.usagesum,T.category[e.category].todaycost=e.data.costsum})}).$promise),o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:n,timeto:n,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.yesterday=e.data.usage,T.ELECTRICITYMETER.cost.yesterday=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.yesterday=e.data.usage,T.COLDWATERMETER.cost.yesterday=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.yesterday=e.data.usage,T.HOTWATERMETER.cost.yesterday=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.yesterday=e.data.usage,T.HEATENERGYMETER.cost.yesterday=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.yesterday=e.data.usage,T.TEMPERATURECONTROL.cost.yesterday=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.yesterday=e.data.usage,T.TIMERMETER.cost.yesterday=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.yesterday=e.data.usage,T.PRESSUREMETER.cost.yesterday=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.yesterday=e.data.usage,T.ULTRACOLDWATERMETER.cost.yesterday=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.yesterday=e.data.usage,T.DDWATERMETER.cost.yesterday=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.yesterday=e.data.usage,T.ENERGYMETER.cost.yesterday=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.yesterday=e.data.usage,T.TTYPETEMPCONTROL.cost.yesterday=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.yesterday=e.data.usage,T.OXYGENMETER.cost.yesterday=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].yesterday=e.data.usagesum,T.category[e.category].yesterdaycost=e.data.costsum})}).$promise),o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:l,timeto:l,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.beforeyesterday=e.data.usage,T.ELECTRICITYMETER.cost.beforeyesterday=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.beforeyesterday=e.data.usage,T.COLDWATERMETER.cost.beforeyesterday=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.beforeyesterday=e.data.usage,T.HOTWATERMETER.cost.beforeyesterday=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.beforeyesterday=e.data.usage,T.HEATENERGYMETER.cost.beforeyesterday=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.beforeyesterday=e.data.usage,T.TEMPERATURECONTROL.cost.beforeyesterday=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.beforeyesterday=e.data.usage,T.TIMERMETER.cost.beforeyesterday=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.beforeyesterday=e.data.usage,T.PRESSUREMETER.cost.beforeyesterday=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.beforeyesterday=e.data.usage,T.ULTRACOLDWATERMETER.cost.beforeyesterday=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.beforeyesterday=e.data.usage,T.DDWATERMETER.cost.beforeyesterday=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.beforeyesterday=e.data.usage,T.ENERGYMETER.cost.beforeyesterday=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.beforeyesterday=e.data.usage,T.TTYPETEMPCONTROL.cost.beforeyesterday=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.beforeyesterday=e.data.usage,T.OXYGENMETER.cost.beforeyesterday=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].beforeyesterday=e.data.usagesum,T.category[e.category].beforeyesterdaycost=e.data.costsum})}).$promise),E.all(o).then(function(){T.chartdata=T.ELECTRICITYMETER[t.type],T.unit="kwh",T.chartTitle="耗电量",T.coldhot={},T.hotcloddata={usage:{today:{},yesterday:{},beforeyesterday:{}},cost:{today:{},yesterday:{},beforeyesterday:{}}},T.fee={today:{},yesterday:{},beforeyesterday:{}},angular.forEach(T.category,function(e){T.todaycost=new BigDecimal(String(e.todaycost)).add(new BigDecimal(String(T.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.yesterdaycost=new BigDecimal(String(e.yesterdaycost)).add(new BigDecimal(String(T.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.beforeyesterdaycost=new BigDecimal(String(e.beforeyesterdaycost)).add(new BigDecimal(String(T.beforeyesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.today=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.today||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.yesterday=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.beforeyesterday=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.beforeyesterday||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.beforeyesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()}),angular.forEach(!angular.equals({},T.TIMERMETER.usage.today)&&T.TIMERMETER.usage||!angular.equals({},T.HEATENERGYMETER.usage.today)&&T.HEATENERGYMETER.usage||!angular.equals({},T.ENERGYMETER.usage.today)&&T.ENERGYMETER.usage,function(e,a){"beforeyesterday"==a&&angular.forEach(e,function(e,a){T.hotcloddata.usage.beforeyesterday[a]={},T.hotcloddata.usage.beforeyesterday[a].timepoint=Number(a),T.hotcloddata.usage.beforeyesterday[a].value=Number(new BigDecimal(String(!angular.equals({},T.TIMERMETER.usage.beforeyesterday)&&T.TIMERMETER.usage.beforeyesterday[a].value||0)).add(new BigDecimal(String(!angular.equals({},T.HEATENERGYMETER.usage.beforeyesterday)&&T.HEATENERGYMETER.usage.beforeyesterday[a].value||0))).add(new BigDecimal(String(!angular.equals({},T.ENERGYMETER.usage.beforeyesterday)&&T.ENERGYMETER.usage.beforeyesterday[a].value||0))).setScale(2,MathContext.ROUND_HALF_UP).toString())})}),angular.forEach(T,function(e){angular.equals({},e.cost)||angular.forEach(e.cost,function(e,a){"today"==a&&angular.forEach(e,function(e,a){!T.fee.today[a]&&(T.fee.today[a]={}),T.fee.today[a].timepoint=Number(a),T.fee.today[a].value=Number(new BigDecimal(String(T.fee.today[a].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"yesterday"==a&&angular.forEach(e,function(e,a){!T.fee.yesterday[a]&&(T.fee.yesterday[a]={}),T.fee.yesterday[a].timepoint=Number(a),T.fee.yesterday[a].value=Number(new BigDecimal(String(T.fee.yesterday[a].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"beforeyesterday"==a&&angular.forEach(e,function(e,a){!T.fee.beforeyesterday[a]&&(T.fee.beforeyesterday[a]={}),T.fee.beforeyesterday[a].timepoint=Number(a),T.fee.beforeyesterday[a].value=Number(new BigDecimal(String(T.fee.beforeyesterday[a].value||0)).add(new BigDecimal(String(e.cost))).toString())})})}),("DAY"==R||angular.isUndefined(R))&&(t.tips={todayELECTRICITYMETER:T.category.ELECTRICITYMETER.today,yesterdayELECTRICITYMETER:T.category.ELECTRICITYMETER.yesterday,beforeyesterdayELECTRICITYMETER:T.category.ELECTRICITYMETER.beforeyesterday,todayCOLDWATERMETER:T.category.COLDWATERMETER.today,yesterdayCOLDWATERMETER:T.category.COLDWATERMETER.yesterday,beforeyesterdayCOLDWATERMETER:T.category.COLDWATERMETER.beforeyesterday,todaycoldhot:T.coldhot.today,yesterdaycoldhot:T.coldhot.today.yesterday,beforeyesterdaycoldhot:T.coldhot.today.beforeyesterday,todaycost:T.todaycost,yesterdaycost:T.yesterdaycost,beforeyesterdaycost:T.beforeyesterdaycost})})):"month"==a?(T.ELECTRICITYMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.COLDWATERMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.HOTWATERMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.HEATENERGYMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.TEMPERATURECONTROL={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.TIMERMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.PRESSUREMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.ULTRACOLDWATERMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.DDWATERMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.ENERGYMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.TTYPETEMPCONTROL={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.OXYGENMETER={cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}},usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.category={},o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:r,timeto:r,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.thisMonth=e.data.usage,T.ELECTRICITYMETER.cost.thisMonth=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.thisMonth=e.data.usage,T.COLDWATERMETER.cost.thisMonth=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.thisMonth=e.data.usage,T.HOTWATERMETER.cost.thisMonth=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.thisMonth=e.data.usage,T.HEATENERGYMETER.cost.thisMonth=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.thisMonth=e.data.usage,T.TEMPERATURECONTROL.cost.thisMonth=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.thisMonth=e.data.usage,T.TIMERMETER.cost.thisMonth=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.thisMonth=e.data.usage,T.PRESSUREMETER.cost.thisMonth=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.thisMonth=e.data.usage,T.ULTRACOLDWATERMETER.cost.thisMonth=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.thisMonth=e.data.usage,T.DDWATERMETER.cost.thisMonth=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.thisMonth=e.data.usage,T.ENERGYMETER.cost.thisMonth=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.thisMonth=e.data.usage,T.TTYPETEMPCONTROL.cost.thisMonth=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.thisMonth=e.data.usage,T.OXYGENMETER.cost.thisMonth=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].thisMonth=e.data.usagesum,T.category[e.category].thisMonthcost=e.data.costsum})}).$promise),o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:n,timeto:n,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.lastMonth=e.data.usage,T.ELECTRICITYMETER.cost.lastMonth=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.lastMonth=e.data.usage,T.COLDWATERMETER.cost.lastMonth=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.lastMonth=e.data.usage,T.HOTWATERMETER.cost.lastMonth=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.lastMonth=e.data.usage,T.HEATENERGYMETER.cost.lastMonth=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.lastMonth=e.data.usage,T.TEMPERATURECONTROL.cost.lastMonth=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.lastMonth=e.data.usage,T.TIMERMETER.cost.lastMonth=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.lastMonth=e.data.usage,T.PRESSUREMETER.cost.lastMonth=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.lastMonth=e.data.usage,T.ULTRACOLDWATERMETER.cost.lastMonth=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.lastMonth=e.data.usage,T.DDWATERMETER.cost.lastMonth=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.lastMonth=e.data.usage,T.ENERGYMETER.cost.lastMonth=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.lastMonth=e.data.usage,T.TTYPETEMPCONTROL.cost.lastMonth=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.lastMonth=e.data.usage,T.OXYGENMETER.cost.lastMonth=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].lastMonth=e.data.usagesum,T.category[e.category].lastMonthcost=e.data.costsum})}).$promise),o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:l,timeto:l,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.beforelastMonth=e.data.usage,T.ELECTRICITYMETER.cost.beforelastMonth=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.beforelastMonth=e.data.usage,T.COLDWATERMETER.cost.beforelastMonth=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.beforelastMonth=e.data.usage,T.HOTWATERMETER.cost.beforelastMonth=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.beforelastMonth=e.data.usage,T.HEATENERGYMETER.cost.beforelastMonth=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.beforelastMonth=e.data.usage,T.TEMPERATURECONTROL.cost.beforelastMonth=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.beforelastMonth=e.data.usage,T.TIMERMETER.cost.beforelastMonth=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.beforelastMonth=e.data.usage,T.PRESSUREMETER.cost.beforelastMonth=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.beforelastMonth=e.data.usage,T.ULTRACOLDWATERMETER.cost.beforelastMonth=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.beforelastMonth=e.data.usage,T.DDWATERMETER.cost.beforelastMonth=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.beforelastMonth=e.data.usage,T.ENERGYMETER.cost.beforelastMonth=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.beforelastMonth=e.data.usage,T.TTYPETEMPCONTROL.cost.beforelastMonth=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.beforelastMonth=e.data.usage,T.OXYGENMETER.cost.beforelastMonth=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].beforelastMonth=e.data.usagesum,T.category[e.category].beforelastMonthcost=e.data.costsum})}).$promise),E.all(o).then(function(){T.chartdata=T.ELECTRICITYMETER[t.type],T.unit="kwh",T.chartTitle="耗电量",T.coldhot={},T.hotcloddata={usage:{thisMonth:{},lastMonth:{},beforelastMonth:{}},cost:{thisMonth:{},lastMonth:{},beforelastMonth:{}}},T.fee={thisMonth:{},lastMonth:{},beforelastMonth:{}},angular.forEach(T.category,function(e){T.thisMonthcost=new BigDecimal(String(e.thisMonthcost)).add(new BigDecimal(String(T.thisMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.lastMonthcost=new BigDecimal(String(e.lastMonthcost)).add(new BigDecimal(String(T.lastMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.beforelastMonthcost=new BigDecimal(String(e.beforelastMonthcost)).add(new BigDecimal(String(T.beforelastMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.thisMonth=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.thisMonth||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.thisMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.lastMonth=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.lastMonth||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.lastMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.beforelastMonth=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.beforelastMonth||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.beforelastMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()}),angular.forEach(!angular.equals({},T.TIMERMETER.usage.thisMonth)&&T.TIMERMETER.usage||!angular.equals({},T.HEATENERGYMETER.usage.thisMonth)&&T.HEATENERGYMETER.usage||!angular.equals({},T.ENERGYMETER.usage.thisMonth)&&T.ENERGYMETER.usage,function(e,a){"beforelastMonth"==a&&angular.forEach(e,function(e,a){T.hotcloddata.usage.beforelastMonth[a]={},T.hotcloddata.usage.beforelastMonth[a].timepoint=Number(a),T.hotcloddata.usage.beforelastMonth[a].value=Number(new BigDecimal(String(!angular.equals({},T.TIMERMETER.usage.beforelastMonth)&&T.TIMERMETER.usage.beforelastMonth[a].value||0)).add(new BigDecimal(String(!angular.equals({},T.HEATENERGYMETER.usage.beforelastMonth)&&T.HEATENERGYMETER.usage.beforelastMonth[a].value||0))).add(new BigDecimal(String(!angular.equals({},T.ENERGYMETER.usage.beforelastMonth)&&T.ENERGYMETER.usage.beforelastMonth[a].value||0))).setScale(2,MathContext.ROUND_HALF_UP).toString())})}),angular.forEach(T,function(e){angular.equals({},e.cost)||angular.forEach(e.cost,function(e,a){"thisMonth"==a&&angular.forEach(e,function(e,a){!T.fee.thisMonth[a]&&(T.fee.thisMonth[a]={}),T.fee.thisMonth[a].timepoint=Number(a),T.fee.thisMonth[a].value=Number(new BigDecimal(String(T.fee.thisMonth[a].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"lastMonth"==a&&angular.forEach(e,function(e,a){!T.fee.lastMonth[a]&&(T.fee.lastMonth[a]={}),T.fee.lastMonth[a].timepoint=Number(a),T.fee.lastMonth[a].value=Number(new BigDecimal(String(T.fee.lastMonth[a].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"beforelastMonth"==a&&angular.forEach(e,function(e,a){!T.fee.beforelastMonth[a]&&(T.fee.beforelastMonth[a]={}),T.fee.beforelastMonth[a].timepoint=Number(a),T.fee.beforelastMonth[a].value=Number(new BigDecimal(String(T.fee.beforelastMonth[a].value||0)).add(new BigDecimal(String(e.cost))).toString())})})})})):"year"==a&&(T.ELECTRICITYMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.COLDWATERMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.HOTWATERMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.HEATENERGYMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.TEMPERATURECONTROL={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.TIMERMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.PRESSUREMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.ULTRACOLDWATERMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.DDWATERMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.ENERGYMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.TTYPETEMPCONTROL={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.OXYGENMETER={cost:{year:{},lastYear:{},beforelastYear:{}},usage:{year:{},lastYear:{},beforelastYear:{}}},T.category={},o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:r,timeto:r,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.year=e.data.usage,T.ELECTRICITYMETER.cost.year=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.year=e.data.usage,T.COLDWATERMETER.cost.year=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.year=e.data.usage,T.HOTWATERMETER.cost.year=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.year=e.data.usage,T.HEATENERGYMETER.cost.year=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.year=e.data.usage,T.TEMPERATURECONTROL.cost.year=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.year=e.data.usage,T.TIMERMETER.cost.year=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.year=e.data.usage,T.PRESSUREMETER.cost.year=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.year=e.data.usage,T.ULTRACOLDWATERMETER.cost.year=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.year=e.data.usage,T.DDWATERMETER.cost.year=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.year=e.data.usage,T.ENERGYMETER.cost.year=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.year=e.data.usage,T.TTYPETEMPCONTROL.cost.year=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.year=e.data.usage,T.OXYGENMETER.cost.year=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].year=e.data.usagesum,T.category[e.category].yearcost=e.data.costsum})}).$promise),o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:n,timeto:n,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.lastYear=e.data.usage,T.ELECTRICITYMETER.cost.lastYear=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.lastYear=e.data.usage,T.COLDWATERMETER.cost.lastYear=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.lastYear=e.data.usage,T.HOTWATERMETER.cost.lastYear=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.lastYear=e.data.usage,T.HEATENERGYMETER.cost.lastYear=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.lastYear=e.data.usage,T.TEMPERATURECONTROL.cost.lastYear=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.lastYear=e.data.usage,T.TIMERMETER.cost.lastYear=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.lastYear=e.data.usage,T.PRESSUREMETER.cost.lastYear=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.lastYear=e.data.usage,T.ULTRACOLDWATERMETER.cost.lastYear=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.lastYear=e.data.usage,T.DDWATERMETER.cost.lastYear=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.lastYear=e.data.usage,T.ENERGYMETER.cost.lastYear=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.lastYear=e.data.usage,T.TTYPETEMPCONTROL.cost.lastYear=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.lastYear=e.data.usage,T.OXYGENMETER.cost.lastYear=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].lastYear=e.data.usagesum,T.category[e.category].lastYearcost=e.data.costsum})}).$promise),o.push(e.eca.analysis({nodes:T.categoryArray,projectid:APP.Project[0]._id,timefrom:l,timeto:l,detail:!0,timetype:R||"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(T.ELECTRICITYMETER.usage.beforelastYear=e.data.usage,T.ELECTRICITYMETER.cost.beforelastYear=e.data.cost):"COLDWATERMETER"==e.category?(T.COLDWATERMETER.usage.beforelastYear=e.data.usage,T.COLDWATERMETER.cost.beforelastYear=e.data.cost):"HOTWATERMETER"==e.category?(T.HOTWATERMETER.usage.beforelastYear=e.data.usage,T.HOTWATERMETER.cost.beforelastYear=e.data.cost):"HEATENERGYMETER"==e.category?(T.HEATENERGYMETER.usage.beforelastYear=e.data.usage,T.HEATENERGYMETER.cost.beforelastYear=e.data.cost):"TEMPERATURECONTROL"==e.category?(T.TEMPERATURECONTROL.usage.beforelastYear=e.data.usage,T.TEMPERATURECONTROL.cost.beforelastYear=e.data.cost):"TIMERMETER"==e.category?(T.TIMERMETER.usage.beforelastYear=e.data.usage,T.TIMERMETER.cost.beforelastYear=e.data.cost):"PRESSUREMETER"==e.category?(T.PRESSUREMETER.usage.beforelastYear=e.data.usage,T.PRESSUREMETER.cost.beforelastYear=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(T.ULTRACOLDWATERMETER.usage.beforelastYear=e.data.usage,T.ULTRACOLDWATERMETER.cost.beforelastYear=e.data.cost):"DDWATERMETER"==e.category?(T.DDWATERMETER.usage.beforelastYear=e.data.usage,T.DDWATERMETER.cost.beforelastYear=e.data.cost):"ENERGYMETER"==e.category?(T.ENERGYMETER.usage.beforelastYear=e.data.usage,T.ENERGYMETER.cost.beforelastYear=e.data.cost):"TTYPETEMPCONTROL"==e.category?(T.TTYPETEMPCONTROL.usage.beforelastYear=e.data.usage,T.TTYPETEMPCONTROL.cost.beforelastYear=e.data.cost):"OXYGENMETER"==e.category&&(T.OXYGENMETER.usage.beforelastYear=e.data.usage,T.OXYGENMETER.cost.beforelastYear=e.data.cost),!T.category[e.category]&&(T.category[e.category]={}),T.category[e.category].beforelastYear=e.data.usagesum,T.category[e.category].beforelastYearcost=e.data.costsum})}).$promise),E.all(o).then(function(){T.chartdata=T.ELECTRICITYMETER[t.type],T.unit="kwh",T.chartTitle="耗电量",T.coldhot={},T.hotcloddata={usage:{year:{},lastYear:{},beforelastYear:{}},cost:{year:{},lastYear:{},beforelastYear:{}}},T.fee={year:{},lastYear:{},beforelastYear:{}},angular.forEach(T.category,function(e){T.yearcost=new BigDecimal(String(e.yearcost)).add(new BigDecimal(String(T.yearcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.lastYearcost=new BigDecimal(String(e.lastYearcost)).add(new BigDecimal(String(T.lastYearcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.beforelastYearcost=new BigDecimal(String(e.beforelastYearcost)).add(new BigDecimal(String(T.beforelastYearcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.year=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.year||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.year||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.lastYear=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.lastYear||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.lastYear||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),T.coldhot.beforelastYear=new BigDecimal(String(T.category.HEATENERGYMETER&&T.category.HEATENERGYMETER.beforelastYear||0)).add(new BigDecimal(String(T.category.ENERGYMETER&&T.category.ENERGYMETER.beforelastYear||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()}),angular.forEach(!angular.equals({},T.TIMERMETER.usage.year)&&T.TIMERMETER.usage||!angular.equals({},T.HEATENERGYMETER.usage.year)&&T.HEATENERGYMETER.usage||!angular.equals({},T.ENERGYMETER.usage.year)&&T.ENERGYMETER.usage,function(e,a){"beforelastYear"==a&&angular.forEach(e,function(e,a){T.hotcloddata.usage.beforelastYear[a]={},T.hotcloddata.usage.beforelastYear[a].timepoint=Number(a),T.hotcloddata.usage.beforelastYear[a].value=Number(new BigDecimal(String(!angular.equals({},T.TIMERMETER.usage.beforelastYear)&&T.TIMERMETER.usage.beforelastYear[a].value||0)).add(new BigDecimal(String(!angular.equals({},T.HEATENERGYMETER.usage.beforelastYear)&&T.HEATENERGYMETER.usage.beforelastYear[a].value||0))).add(new BigDecimal(String(!angular.equals({},T.ENERGYMETER.usage.beforeyesterday)&&T.ENERGYMETER.usage.beforeyesterday[a].value||0))).setScale(2,MathContext.ROUND_HALF_UP).toString())})}),angular.forEach(T,function(e){angular.equals({},e.cost)||angular.forEach(e.cost,function(e,a){"year"==a&&angular.forEach(e,function(e,a){!T.fee.year[a]&&(T.fee.year[a]={}),T.fee.year[a].timepoint=Number(a),T.fee.year[a].value=Number(new BigDecimal(String(T.fee.year[a].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"lastYear"==a&&angular.forEach(e,function(e,a){!T.fee.lastYear[a]&&(T.fee.lastYear[a]={}),T.fee.lastYear[a].timepoint=Number(a),T.fee.lastYear[a].value=Number(new BigDecimal(String(T.fee.lastYear[a].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"beforelastYear"==a&&angular.forEach(e,function(e,a){!T.fee.beforelastYear[a]&&(T.fee.beforelastYear[a]={}),T.fee.beforelastYear[a].timepoint=Number(a),T.fee.beforelastYear[a].value=Number(new BigDecimal(String(T.fee.beforelastYear[a].value||0)).add(new BigDecimal(String(e.cost))).toString())})})})}))},T.initialize()}),T.gridOptions={onRegisterApi:function(e){self.gridApi=e},rowHeight:34,infiniteScrollDown:!0,enableColumnMenus:!1,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,a,t,o){return{name:!0,addr:!0,title:!0,time:!0}[t.field]?'="'+(o||"")+'"':o}},T.columnDefsData=function(){T.gridOptions.rowHeight=45,"DAY"==R?T.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"00:00",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"01:00",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02:00",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03:00",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04:00",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05:00",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06:00",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07:00",name:"hour7",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08:00",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09:00",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10:00",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11:00",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12:00",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13:00",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14:00",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15:00",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16:00",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17:00",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18:00",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19:00",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20:00",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21:00",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22:00",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23:00",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]:"MONTH"==R?T.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"01",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"24",name:"hour24",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"25",name:"hour25",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"26",name:"hour26",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"27",name:"hour27",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"28",name:"hour28",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"29",name:"hour29",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"30",name:"hour30",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"31",name:"hour31",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]:"YEAR"==R&&(T.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"01",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08",name:"hour7",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}])},T.getpie=function(a,t,o){e.eca.analysis({nodes:T.itemArray,projectid:APP.Project[0]._id,timefrom:r,timeto:r,devicetype:a,detail:!0,timetype:R||"DAY"},function(e){T.piedata={},T.gridOptions.data=[],T.pieunit={title:"总"+o,unit:t},a&&angular.forEach(e.result,function(e){var a={},t=0;a.name=e.title,null!=!e.data.usage&&angular.equals({},e.data.usage)||(angular.forEach(e.data.usage,function(e){a["hour"+t]=angular.isDefined(e.value)&&e.value||"-",t++}),T.gridOptions.data.push(a),T.piedata[e.title]=e.data.usagesum||0)}),!a&&angular.forEach(e.result,function(e){var a={},t=0;a.name=e.title,null!=!e.data.cost&&angular.equals({},e.data.cost)||(angular.forEach(e.data.cost,function(e){a["hour"+t]=angular.isDefined(e.cost)&&e.cost||"-",t++}),T.gridOptions.data.push(a),T.piedata[e.title]=e.data.costsum||0)}),T.columnDefsData()})},e.eca.info({projectid:APP.Project[0]._id,type:"BYITEM"},function(e){var a=e.result;T.itemArray=[],angular.forEach(a,function(e){T.itemArray.push(e.id)})}).$promise.then(function(){T.getpie("ELECTRICITYMETER","kwh","耗电量")}),T.getdevicedata=function(e,a,o){T.unit=a,T.title=o,T.chartdata=T[e][t.type],"hotcloddata"===e?(T.device=["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],T.getpie(["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],a,o)):(T.device=e,T.unit=a,T.title=o,T.getpie(e,a,o)),T.chartTitle=o},T.getfeedata=function(){T.chartdata=T.fee,T.chartTitle="总费用",e.eca.info({projectid:APP.Project[0]._id,type:"BYITEM"},function(e){var a=e.result;T.itemArray=[],angular.forEach(a,function(e){T.itemArray.push(e.id)})}).$promise.then(function(){T.getpie(void 0,"元","费用")})},T.redata=function(){T.ELECTRICITYMETER={},T.COLDWATERMETER={},T.HOTWATERMETER={},T.HEATENERGYMETER={},T.TEMPERATURECONTROL={},T.TIMERMETER={},T.PRESSUREMETER={},T.ULTRACOLDWATERMETER={},T.DDWATERMETER={},T.ENERGYMETER={},T.TTYPETEMPCONTROL={},T.OXYGENMETER={},T.category={}},T.gettimedata=function(e){"today"==e?(T.redata(),r=T.today,n=T.yesterday,l=T.beforeyesterday,R="DAY"):"month"==e?(T.redata(),r=T.thisMonth,n=T.lastMonth,l=T.beforelastMonth,R="MONTH"):"year"==e&&(T.redata(),r=T.year,n=T.lastyear,l=T.beforelastyear,R="YEAR"),T.initialize(e),T.getpie(T.device,T.unit,T.title)}}]}),angular.module("app").component("ele",{templateUrl:"app/modules/analyse/ele.html?rev=e179134e6e",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api",function(e,a,t){var o=this;e.$watchCollection(function(){return o.data},function(e){var a=[],t=[];o.charttype="column",angular.forEach(o.data,function(e,E,s){o.key=E,Object.keys(e).length>a.length&&(s=0,a=[]),angular.forEach(e,function(e){this.push(e.value),0===s&&a.push(parseInt(e.timepoint))},e=[]),t.push({data:e,name:"today"==E&&"今日"||"yesterday"==E&&"昨日"||"beforeyesterday"==E&&"前日"||"thisMonth"==E&&"本月"||"lastMonth"==E&&"上月"||"beforelastMonth"==E&&"前月"||"year"==E&&"本年"||"lastYear"==E&&"去年"||"beforelastYear"==E&&"前年"})}),o.typeChange=function(e){e&&(o.charttype=e),o.energyconstitute={chart:{type:o.charttype,backgroundColor:"rgba(0, 0, 0, 0)"},title:!1,xAxis:{categories:a,labels:{formatter:function(){return"today"==o.key||"yesterday"==o.key||"beforeyesterday"==o.key?moment(this.value).hour():"thisMonth"==o.key||"lastMonth"==o.key||"beforelastMonth"==o.key?moment(this.value).date():"year"==o.key||"lastYear"==o.key||"beforelastYear"==o.key?moment(this.value).month()+1:void 0},style:{color:"#fff"}}},yAxis:{title:!1,labels:{style:{color:"#fff"}}},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y} '+o.unit+"</span>"},series:t}},o.typeChange()})}]}),angular.module("app").component("pie",{templateUrl:"app/modules/analyse/pie.html?rev=88c8596f6c",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api",function(e,a,t){var o=this;e.$watchCollection(function(){return o.data},function(){data=o.data||{};var e=0;o.unit||(o.unit={title:"总耗电量",unit:"kwh"}),angular.forEach(data,function(a,t){this.push([t,a]),e=Number(new BigDecimal(String(e)).add(new BigDecimal(String(a))).toString())},data=[]),o.dailysensordetail={chart:{marginLeft:-10,marginRight:200,style:{textAlign:"left"},backgroundColor:"rgba(0, 0, 0, 0)",type:"pie"},title:{text:'<div class="pieTitle">'+o.unit.title+"</div><div>"+e+o.unit.unit+"</div>",verticalAlign:"middle",useHTML:!0,x:-100,y:-5},tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"80%",showInLegend:!0}},legend:{align:"center",verticalAlign:"middle",layout:"vertical",labelFormatter:function(){var e=Math.round(10*this.percentage)/10+"% "+this.name,a=Math.round(100*(this.y||0))/100+o.unit.unit;return['<span class="center-block" title="'+e+'">'+e+"</span>",'<span class="center-block text-muted" title="'+a+'">'+a+"</span>"].join("")},itemWidth:200,x:140,useHTML:!0},series:[{cropThreshold:0,turboThreshold:0,data:data}]}})}]});