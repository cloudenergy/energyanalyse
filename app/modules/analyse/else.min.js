angular.module("app").component("else",{templateUrl:"app/modules/analyse/else.html?rev=3609c524cd",controller:["$api","$scope","$state","$q","$stateParams","$rootScope",function(e,t,a,n,l,i){var o=this;o.startDate=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()),o.endDate=function(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),n=t.getMonth()+1,l=t.getDate();return String(a)+String(n<10&&"0"+n||n)+String(l)}(0),o.more=[{key:"HOTWATERMETER",title:"热水表",unit:"m3"},{key:"TEMPERATURECONTROL",title:"温控器",unit:"m3"},{key:"TTYPETEMPCONTROL",title:"T型温控器",unit:"m3"},{key:"DDWATERMETER",title:"直饮水表",unit:"m3"},{key:"ULTRACOLDWATERMETER",title:"超声波水表",unit:"m3"},{key:"PRESSUREMETER",title:"压力表",unit:"Pa"},{key:"OXYGENMETER",title:"氧气表",unit:"m3"}],o.analyseType=[{title:"分项能耗",key:"BYITEM",href:'dashboard.else({datatype:"BYITEM"})'},{title:"区域能耗",key:"CUSTOMER",href:'dashboard.else({datatype:"CUSTOMER"})'},{title:"部门能耗",key:"BYAPART",href:'dashboard.else({datatype:"BYAPART"})'}],o.gridOptions={onRegisterApi:function(e){self.gridApi=e},rowHeight:34,infiniteScrollDown:!0,enableColumnMenus:!1,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,t,a,n){return{name:!0,addr:!0,title:!0,time:!0}[a.field]?'="'+(n||"")+'"':n}},o.columnDefsData=function(){o.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"01",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"24",name:"hour24",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"25",name:"hour25",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"26",name:"hour26",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"27",name:"hour27",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"28",name:"hour28",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"29",name:"hour29",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"30",name:"hour30",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"31",name:"hour31",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]},o.getpie=function(t,a,n){e.eca.analysis({nodes:o.itemArray,projectid:APP.Project[0]._id,timefrom:o.startDate,timeto:o.endDate,devicetype:t,detail:!0,timetype:"MONTH"},function(e){o.piedata={},o.gridOptions.data=[],o.pieunit={title:"总"+n,unit:a},t&&angular.forEach(e.result,function(e){var t={},a=0;t.name=e.title,null!=!e.data.usage&&angular.equals({},e.data.usage)||(angular.forEach(e.data.usage,function(e){t["hour"+a]=angular.isDefined(e.value)&&e.value||"-",a++}),o.gridOptions.data.push(t),o.piedata[e.title]=e.data.usagesum||0)}),!t&&angular.forEach(e.result,function(e){var t={},a=0;t.name=e.title,null!=!e.data.cost&&angular.equals({},e.data.cost)||(angular.forEach(e.data.cost,function(e){t["hour"+a]=angular.isDefined(e.cost)&&e.cost||"-",a++}),o.gridOptions.data.push(t),o.piedata[e.title]=e.data.costsum||0)}),o.columnDefsData()})},e.eca.info({projectid:APP.Project[0]._id,type:l.datatype},function(e){var t=e.result;o.itemArray=[],angular.forEach(t,function(e){o.itemArray.push(e.id)})}).$promise.then(function(){o.getpie(void 0,void 0,"BYITEM"==l.datatype&&"分项能耗"||"CUSTOMER"==l.datatype&&"区域能耗"||"BYAPART"==l.datatype&&"部门能耗")}),o.getdevicedata=function(e,t,a){o.unit=t,o.title=a,o.chartdata=o[e].usage,"hotcloddata"===e?(o.device=["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],o.getpie(["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],t,a)):(o.device=e,o.unit=t,o.title=a,o.getpie(e,t,a)),o.chartTitle=a},o.gettimedata=function(){o.initialize(),o.getpie(void 0,o.unit,o.title)},t.$watch("$ctrl.customerSelected",function(t){e.eca.info({projectid:APP.Project[0]._id,type:l.datatype||"BYCATEGORY"},function(e){var t=e.result;o.categoryArray=[],angular.forEach(t,function(e){o.categoryArray.push(e.id)})}).$promise.then(function(){o.device=void 0,o.unit=void 0,o.title="BYITEM"==l.datatype&&"分项能耗"||"CUSTOMER"==l.datatype&&"区域能耗"||"BYAPART"==l.datatype&&"部门能耗",o.initialize=function(a){o.category={},o.elsedata={},o.elsedatacost={},o.elsedatasum={},e.eca.analysis({nodes:t&&[t]||o.categoryArray,projectid:APP.Project[0]._id,timefrom:o.startDate,timeto:o.endDate,detail:!0,timetype:"MONTH"},function(e){angular.forEach(e.result,function(e){o.elsedata[e.category+"usage"]=e.data.usage,o.elsedata[e.category+"usage"].name=e.title,o.elsedatacost[e.category+"cost"]=e.data.cost,o.elsedatasum[e.category+"usagesum"]=e.data.usagesum,o.elsedatacost[e.category+"costsum"]=e.data.costsum}),o.chartdata=o.elsedata})},o.initialize(),o.getdevicedata(o.devicetype,o.unit,o.title)})})}]}),angular.module("app").component("pile",{templateUrl:"app/modules/analyse/ele.html?rev=fbb71134c8",bindings:{data:"=",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api",function(e,t,a){var n=this;e.$watchCollection(function(){return n.data},function(e){var t=[],a=[];n.charttype="column",angular.forEach(n.data,function(e,l,i){var o=[];n.key=l,Object.keys(e).length>t.length&&(i=0,t=[]),angular.forEach(e,function(e){e.value&&this.push(e.value),0===i&&t.push(parseInt(e.timepoint))},o),a.push({data:o,name:e.name});var r=["#24CBE5","#FF9655","#FFF263","#6AF9C4","#64E572"];angular.forEach(r,function(e,t){a[t]&&(a[t].color=e)})}),n.typeChange=function(e){e&&(n.charttype=e),"column"==n.charttype?n.energyconstitute={chart:{type:"column",height:"520",backgroundColor:"rgba(0, 0, 0, 0)"},title:{text:""},xAxis:{categories:t,labels:{formatter:function(){return Number(String(moment(this.value).year())+String(moment(this.value).month()+1)+String(moment(this.value).date()))},style:{color:"#d4ecff"}}},yAxis:{min:0,stackLabels:{enabled:!0,style:{fontWeight:"bold",color:"white"}}},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"<br/>总量: "+this.point.stackTotal}},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,color:"white",style:{textShadow:"0 0 3px black"}}}},series:a}:n.energyconstitute={chart:{type:n.charttype,backgroundColor:"rgba(0, 0, 0, 0)"},title:!1,xAxis:{categories:t,labels:{formatter:function(){return Number(String(moment(this.value).year())+String(moment(this.value).month()+1)+String(moment(this.value).date()))},style:{color:"#d4ecff"}}},yAxis:{title:!1},tooltip:{xDateFormat:String(moment(this.value).year())+String(moment(this.value).month()+1)+String(moment(this.value).date()),pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y} '+n.unit+"</span>"},series:a}},n.typeChange()})}]});