"use strict";angular.module("app").component("ranking",{templateUrl:"app/modules/ranking/ranking.html?rev=c475ce1c1a",controller:["$scope","$rootScope","$api","$interval","$timeout",function(e,t,a,i,r){}]}),angular.module("app").component("rankingTable",{templateUrl:"app/modules/ranking/rankingTable.html?rev=80eeebf322",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$interval","$timeout",function(e,t,a,i,r){var o=this;console.log("::"),data=self.data||{};var n=0;self.unit||(self.unit={title:"总耗电量",unit:"kwh"}),angular.forEach(data,function(e,t){this.push([t,e]),n=Number(new BigDecimal(String(n)).add(new BigDecimal(String(e))).toString())},data=[]),self.dailysensordetail={chart:{marginLeft:-10,marginRight:200,style:{textAlign:"left"},backgroundColor:"rgba(0, 0, 0, 0)",type:"pie"},title:{text:'<div class="pieTitle">'+self.unit.title+"</div><div>"+n+self.unit.unit+"</div>",verticalAlign:"middle",useHTML:!0,x:-100,y:-5},tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"80%",showInLegend:!0}},legend:{align:"center",verticalAlign:"middle",layout:"vertical",labelFormatter:function(){var e=Math.round(10*this.percentage)/10+"% "+this.name,t=Math.round(100*(this.y||0))/100+self.unit.unit;return['<span class="center-block" title="'+e+'">'+e+"</span>",'<span class="center-block text-muted" title="'+t+'">'+t+"</span>"].join("")},itemWidth:200,x:140,useHTML:!0},series:[{cropThreshold:0,turboThreshold:0,data:data,colors:["#24CBE5","#FF9655","#FFF263","#6AF9C4","#64E572"]}]};var l=["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"];e.chartType="energy",e.baseConfig={dataLoaded:!0},e.barConfig=angular.copy(e.baseConfig),o.unactive=!0,o.custom=function(){a.eca.info({projectid:APP.Project[0]._id,type:"CUSTOMER"},function(e){var t=e.result;o.categoryArray=[],angular.forEach(t,function(e){o.categoryArray.push(e.id)})}).$promise.then(function(){a.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(t){o.data=t.result,angular.forEach(o.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),o.data=o.data.sort(function(e){return function(t,a){return t[e]-a[e]}}("kgcesum")),o.data=o.data.slice(-10),o.yname=[],o.series=[],angular.forEach(o.data,function(e){o.yname.push(e.title),o.series.push(e.data&&e.data.kgcesum||0)}),e.barOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,y:0,y2:0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(0,0,0,0)"}}},yAxis:{type:"category",axisLabel:{interval:0},data:o.yname},textStyle:{color:"#000"},series:[{type:"bar",data:o.series}]},o.typeChange=function(a){"bar"==a?e.barOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(0,0,0,0)"}}},yAxis:{type:"category",data:o.yname},textStyle:{color:"#000"},series:[{type:"bar",data:o.series}]}:"pie"==a&&(o.legendData=[],o.selected={},o.seriesData=[],angular.forEach(o.data,function(e){o.legendData.push(e.title),o.selected[e.title]=!0,o.seriesData.push({name:e.title,value:e.kgcesum})}),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:t.legendData,textStyle:{color:"#000"},selected:t.selected},series:[{type:"pie",radius:"55%",center:["40%","50%"],label:{show:!1},labelLine:{normal:{show:!1}},data:o.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:l}]})}})})},o.custom(),o.byitem=function(){a.eca.info({projectid:APP.Project[0]._id,type:"BYITEM"},function(e){var t=e.result;o.categoryArray=[],angular.forEach(t,function(e){o.categoryArray.push(e.id)})}).$promise.then(function(){o.ele=function(){a.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,devicetype:["ELECTRICITYMETER","MELECTRICITYMETER"],timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(t){o.data=t.result,angular.forEach(o.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),o.legendData=[],o.selected={},o.seriesData=[],angular.forEach(o.data,function(e){o.legendData.push(e.title),o.selected[e.title]=!0,o.seriesData.push({name:e.title,value:e.kgcesum})}),console.log(o.seriesData),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:t.legendData,textStyle:{color:"#000"},selected:t.selected},series:[{name:"",type:"pie",radius:"55%",center:["40%","50%"],data:o.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:l}]}})},o.ele(),o.water=function(){a.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,devicetype:["COLDWATERMETER","HOTWATERMETER","ULTRACOLDWATERMETER"],timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(t){o.data=t.result,angular.forEach(o.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),o.legendData=[],o.selected={},o.seriesData=[],angular.forEach(o.data,function(e){o.legendData.push(e.title),o.selected[e.title]=!0,o.seriesData.push({name:e.title,value:e.kgcesum})}),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:t.legendData,textStyle:{color:"#000"},selected:t.selected},series:[{type:"pie",radius:"55%",center:["40%","50%"],data:o.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:l}]}})}})}}]});