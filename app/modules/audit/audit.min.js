angular.module("app").component("audit",{templateUrl:"app/modules/audit/audit.html?rev=ba16f870f3",controller:["$api","$scope","$state","$q","$stateParams",function(t,e,a,n,i){$("body").css("background","url(/app/img/main-bg1.png?rev=dc835b439e) no-repeat center center");var r=this;r.startDate=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()),r.endDate=function(t){var e=new Date;e.setDate(e.getDate()+t);var a=e.getFullYear(),n=e.getMonth()+1,i=e.getDate();return String(a)+String(n<10&&"0"+n||n)+String(i)}(0),r.more=[{key:"ALL",title:"东一教学楼"},{key:"HOTWATERMETER",title:"东二教学楼"},{key:"TEMPERATURECONTROL",title:"西一教学楼"},{key:"TTYPETEMPCONTROL",title:" 西二教学楼"},{key:"DDWATERMETER",title:"宿舍"}],r.energytype=r.more[0].title,r.chooseenergytype=function(t){r.energytype=t.title},t.eca.info({projectid:APP.Project[0]._id,type:"BYITEM"},function(t){var e=t.result;r.itemArray=[],angular.forEach(e,function(t){r.itemArray.push(t.id)})}).$promise.then(function(){t.eca.analysis({nodes:r.itemArray,projectid:APP.Project[0]._id,timefrom:r.startDate,timeto:r.endDate,detail:!0,timetype:"DAY"},function(t){r.piedata={},angular.forEach(t.result,function(t){r.piedata[t.title]=t.data.usagesum||0}),console.log(r.piedata)})})}]}),angular.module("app").component("auditpie",{templateUrl:"app/modules/audit/auditpie.html?rev=ae517a1ed1",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api",function(t,e,a){console.log(this);var n=this;t.$watchCollection(function(){return n.data},function(){data=n.data||{};var t=0;n.unit||(n.unit={title:"总耗电量",unit:"kwh"}),angular.forEach(data,function(e,a){this.push([a,e]),t=Number(new BigDecimal(String(t)).add(new BigDecimal(String(e))).toString())},data=[]),n.dailysensordetail={chart:{marginLeft:-10,marginRight:200,style:{textAlign:"left"},backgroundColor:"rgba(0, 0, 0, 0)",type:"pie"},title:{text:'<div class="pieTitle">'+n.unit.title+"</div><div>"+t+n.unit.unit+"</div>",verticalAlign:"middle",useHTML:!0,x:-100,y:-5},tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"80%",showInLegend:!0}},legend:{align:"center",verticalAlign:"middle",layout:"vertical",labelFormatter:function(){var t=Math.round(10*this.percentage)/10+"% "+this.name,e=Math.round(100*(this.y||0))/100+n.unit.unit;return['<span class="center-block" title="'+t+'">'+t+"</span>",'<span class="center-block text-muted" title="'+e+'">'+e+"</span>"].join("")},itemWidth:200,x:140,useHTML:!0},series:[{cropThreshold:0,turboThreshold:0,data:data}]}})}]});