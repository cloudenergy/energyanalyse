angular.module("app").component("audit",{templateUrl:"app/modules/audit/audit.html?rev=f94012c382",controller:["$api","$scope","$state","$q","$stateParams","$uibModal",function(e,t,a,r,o,n){function i(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),r=t.getMonth()+1,o=t.getDate();return String(a)+String(r<10&&"0"+r||r)+String(o)}var l=this;l.energyNum=0,l.lastMonth=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth())),l.lastYearMonth=String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),l.thisMonth=String((new Date).getFullYear())+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),l.startDate=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()),l.endDate=i(0),l.date=i(0).split("")[0]+i(0).split("")[1]+i(0).split("")[2]+i(0).split("")[3]+"-"+i(0).split("")[4]+i(0).split("")[5]+"-"+i(0).split("")[6]+i(0).split("")[7],l.more=[{key:"ALL",title:"东一教学楼"},{key:"HOTWATERMETER",title:"东二教学楼"},{key:"TEMPERATURECONTROL",title:"西一教学楼"},{key:"TTYPETEMPCONTROL",title:" 西二教学楼"},{key:"DDWATERMETER",title:"宿舍"}],l.energytype=l.more[0].title,l.chooseenergytype=function(e){l.energytype=e.title},e.project.auditParameter({projectId:APP.Project[0]._id,time:(new Date).getFullYear()},function(t){t=t.result,l.eleConsumptionPerArea=t.eleConsumptionPerArea,l.consumptionPerCapita=t.consumptionPerCapita,l.indicator=t.indicator,e.project.auditParameter({projectId:APP.Project[0]._id,time:(new Date).getFullYear()-1},function(e){e=e.result,l.eleConsumptionPerAreaP=e.eleConsumptionPerArea&&(l.eleConsumptionPerArea-e.eleConsumptionPerArea)/l.eleConsumptionPerArea*100||100,l.consumptionPerCapitaP=e.consumptionPerCapita&&(l.consumptionPerCapita-e.consumptionPerCapita)/l.consumptionPerCapita*100||100},function(e){l.eleConsumptionPerAreaP=e.eleConsumptionPerArea&&(l.eleConsumptionPerArea-e.eleConsumptionPerArea)/l.eleConsumptionPerArea*100||100,l.consumptionPerCapitaP=e.consumptionPerCapita&&(l.consumptionPerCapita-e.consumptionPerCapita)/l.consumptionPerCapita*100||100})}),l.OnImport=function(){n.open({size:"sm",templateUrl:"import.html",controller:["$scope","$uibModalInstance","SweetAlert",function(e,t,a){e.actionURL="/api/import/auditParameter?",e.Character="54d032dd877012ac6d37063f",e.ProjectID=APP.Project[0]._id,e.OnCancel=t.dismiss,e.OnUploadComplete=function(e){console.log(e),e.code?a.error(e.result,e.message):(a.success("导入成功"),t.close())}}],resolve:{ProjectID:function(){return APP.Project[0]._id}}}).result.then(t.GetDepartment)},e.business.projectYearKGCE({projectid:APP.Project[0]._id},function(e){e=e.result,l.energyNum=e.sum,l.area=e.area,l.energyArea=l.energyNum/l.area,l.monthly=e.monthly})}]}),angular.module("app").component("auditbar",{templateUrl:"app/modules/audit/auditbar.html?rev=80eeebf322",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$interval","$timeout",function(e,t,a,r,o){var n=this;e.$watchCollection(function(){return self.data},function(){var t=["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"];e.chartType="energy",e.baseConfig={dataLoaded:!0},e.barConfig=angular.copy(e.baseConfig),n.unactive=!0,n.custom=function(){a.eca.info({projectid:APP.Project[0]._id,type:"CUSTOMER"},function(e){var t=e.result;n.categoryArray=[],angular.forEach(t,function(e){n.categoryArray.push(e.id)})}).$promise.then(function(){a.eca.analysis({nodes:n.categoryArray,projectid:APP.Project[0]._id,timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(a){n.data=a.result,angular.forEach(n.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),n.data=n.data.sort(function(e){return function(t,a){return t[e]-a[e]}}("kgcesum")),n.data=n.data.slice(-10),n.yname=[],n.series=[],angular.forEach(n.data,function(e){n.yname.push(e.title),n.series.push(e.data&&e.data.kgcesum||0)}),e.barOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,y:0,y2:0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(0,0,0,0)"}}},yAxis:{type:"category",axisLabel:{interval:0},data:n.yname},textStyle:{color:"#000"},series:[{type:"bar",data:n.series}]},n.typeChange=function(r){"bar"==r?e.barOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(0,0,0,0)"}}},yAxis:{type:"category",data:n.yname},textStyle:{color:"#000"},series:[{type:"bar",data:n.series}]}:"pie"==r&&(n.legendData=[],n.selected={},n.seriesData=[],angular.forEach(n.data,function(e){n.legendData.push(e.title),n.selected[e.title]=!0,n.seriesData.push({name:e.title,value:e.kgcesum})}),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:a.legendData,textStyle:{color:"#000"},selected:a.selected},series:[{type:"pie",radius:"55%",center:["40%","50%"],label:{show:!1},labelLine:{normal:{show:!1}},data:n.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:t}]})}})})},n.custom(),n.byitem=function(){a.eca.info({projectid:APP.Project[0]._id,type:"BYITEM"},function(e){var t=e.result;n.categoryArray=[],angular.forEach(t,function(e){n.categoryArray.push(e.id)})}).$promise.then(function(){n.ele=function(){a.eca.analysis({nodes:n.categoryArray,projectid:APP.Project[0]._id,devicetype:["ELECTRICITYMETER","MELECTRICITYMETER"],timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(a){n.data=a.result,angular.forEach(n.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),n.legendData=[],n.selected={},n.seriesData=[],angular.forEach(n.data,function(e){n.legendData.push(e.title),n.selected[e.title]=!0,n.seriesData.push({name:e.title,value:e.kgcesum})}),console.log(n.seriesData),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:a.legendData,textStyle:{color:"#000"},selected:a.selected},series:[{name:"",type:"pie",radius:"55%",center:["40%","50%"],data:n.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:t}]}})},n.ele(),n.water=function(){a.eca.analysis({nodes:n.categoryArray,projectid:APP.Project[0]._id,devicetype:["COLDWATERMETER","HOTWATERMETER","ULTRACOLDWATERMETER"],timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(a){n.data=a.result,angular.forEach(n.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),n.legendData=[],n.selected={},n.seriesData=[],angular.forEach(n.data,function(e){n.legendData.push(e.title),n.selected[e.title]=!0,n.seriesData.push({name:e.title,value:e.kgcesum})}),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:a.legendData,textStyle:{color:"#000"},selected:a.selected},series:[{type:"pie",radius:"55%",center:["40%","50%"],data:n.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:t}]}})}})}})}]}),angular.module("app").component("auditline",{templateUrl:"app/modules/audit/auditline.html?rev=716d8314fe",bindings:{data:"<",unit:"<",type:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$interval","$timeout",function(e,t,a,r,o){var n=this;e.$watchCollection(function(){return n.data},function(){n.thisYear=(new Date).getFullYear(),n.lastYear=n.thisYear-1,n.beforeLastYear=n.thisYear-2,n.typeChange=function(t){t&&(n.type=t),e.lineOption={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["参照用量","本年用量"],textStyle:{color:"#000"}},toolbox:{feature:{saveAsImage:{}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:["一月","二月","三月","四月","五月","六月"]}],yAxis:[{type:"value"}],textStyle:{color:"#000"},series:[{name:"参照用量",type:n.type||"line",stack:"line"==n.type&&"总量"||null,smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#d68262"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#d68262"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:n.data},{name:"本年用量",type:n.type||"line",stack:"line"==n.type&&"总量"||null,smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#8ec6ad"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#8ec6ad"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:n.series}]}},e.baseConfig={dataLoaded:!0},e.lineConfig=angular.copy(e.baseConfig),a.business.projectYearKGCE({projectid:APP.Project[0]._id},function(t){n.series=t.monthly,e.lineOption={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["参照用量","本年用量"],textStyle:{color:"#000"}},toolbox:{feature:{saveAsImage:{}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:["一月","二月","三月","四月","五月"]}],yAxis:[{type:"value"}],textStyle:{color:"#000"},series:[{name:"参照用量",type:n.type||"line",stack:"总量",areaStyle:{normal:{}},smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#d68262"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#d68262"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:n.data},{name:"本年用量",type:n.type||"line",stack:"总量",areaStyle:{normal:{}},smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#8ec6ad"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#8ec6ad"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:n.series}]}})})}]});