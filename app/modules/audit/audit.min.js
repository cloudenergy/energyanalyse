angular.module("app").component("audit",{templateUrl:"app/modules/audit/audit.html?rev=f94012c382",controller:["$api","$scope","$state","$q","$stateParams","$uibModal",function(e,t,a,r,n,o){function i(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),r=t.getMonth()+1,n=t.getDate();return String(a)+String(r<10&&"0"+r||r)+String(n)}var l=this;l.energyNum=0,l.lastMonth=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth())),l.lastYearMonth=String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),l.thisMonth=String((new Date).getFullYear())+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),l.startDate=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()),l.endDate=i(0),l.date=i(0).split("")[0]+i(0).split("")[1]+i(0).split("")[2]+i(0).split("")[3]+"-"+i(0).split("")[4]+i(0).split("")[5]+"-"+i(0).split("")[6]+i(0).split("")[7],l.more=[{key:"ALL",title:"东一教学楼"},{key:"HOTWATERMETER",title:"东二教学楼"},{key:"TEMPERATURECONTROL",title:"西一教学楼"},{key:"TTYPETEMPCONTROL",title:" 西二教学楼"},{key:"DDWATERMETER",title:"宿舍"}],l.energytype=l.more[0].title,l.chooseenergytype=function(e){l.energytype=e.title},e.project.auditParameter({projectId:APP.Project[0]._id,time:(new Date).getFullYear()},function(t){t=t.result,l.eleConsumptionPerArea=t.eleConsumptionPerArea,l.consumptionPerCapita=t.consumptionPerCapita,l.indicator=t.indicator,e.project.auditParameter({projectId:APP.Project[0]._id,time:(new Date).getFullYear()-1},function(e){e=e.result,l.eleConsumptionPerAreaP=e.eleConsumptionPerArea&&(l.eleConsumptionPerArea-e.eleConsumptionPerArea)/l.eleConsumptionPerArea*100||100,l.consumptionPerCapitaP=e.consumptionPerCapita&&(l.consumptionPerCapita-e.consumptionPerCapita)/l.consumptionPerCapita*100||100},function(e){l.eleConsumptionPerAreaP=e.eleConsumptionPerArea&&(l.eleConsumptionPerArea-e.eleConsumptionPerArea)/l.eleConsumptionPerArea*100||100,l.consumptionPerCapitaP=e.consumptionPerCapita&&(l.consumptionPerCapita-e.consumptionPerCapita)/l.consumptionPerCapita*100||100})}),l.OnImport=function(){o.open({size:"sm",templateUrl:"import.html",controller:["$scope","$uibModalInstance","SweetAlert",function(e,t,a){e.actionURL="/api/import/auditParameter?",e.Character="54d032dd877012ac6d37063f",e.ProjectID=APP.Project[0]._id,e.OnCancel=t.dismiss,e.OnUploadComplete=function(e){e.code?a.error(e.result,e.message):(a.success("导入成功"),t.close())}}],resolve:{ProjectID:function(){return APP.Project[0]._id}}}).result.then(t.GetDepartment)},e.business.projectYearKGCE({projectid:APP.Project[0]._id},function(e){e=e.result,l.energyNum=e.sum,l.area=e.area,l.energyArea=l.energyNum/l.area,l.monthly=e.monthly})}]}),angular.module("app").component("auditbar",{templateUrl:"app/modules/audit/auditbar.html?rev=80eeebf322",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$interval","$timeout",function(e,t,a,r,n){var o=this;e.$watchCollection(function(){return self.data},function(){var t=["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"];e.chartType="energy",e.baseConfig={dataLoaded:!0},e.barConfig=angular.copy(e.baseConfig),o.unactive=!0,o.custom=function(){a.eca.info({projectid:APP.Project[0]._id,type:"CUSTOMER"},function(e){var t=e.result;o.categoryArray=[],angular.forEach(t,function(e){o.categoryArray.push(e.id)})}).$promise.then(function(){a.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(a){o.data=a.result,angular.forEach(o.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),o.data=o.data.sort(function(e){return function(t,a){return t[e]-a[e]}}("kgcesum")),o.data=o.data.slice(-10),o.yname=[],o.series=[],angular.forEach(o.data,function(e){o.yname.push(e.title),o.series.push(e.data&&e.data.kgcesum||0)}),e.barOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,y:0,y2:0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(0,0,0,0)"}}},yAxis:{type:"category",axisLabel:{interval:0},data:o.yname},textStyle:{color:"#000"},series:[{type:"bar",data:o.series}]},o.typeChange=function(r){"bar"==r?e.barOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(0,0,0,0)"}}},yAxis:{type:"category",data:o.yname},textStyle:{color:"#000"},series:[{type:"bar",data:o.series}]}:"pie"==r&&(o.legendData=[],o.selected={},o.seriesData=[],angular.forEach(o.data,function(e){o.legendData.push(e.title),o.selected[e.title]=!0,o.seriesData.push({name:e.title,value:e.kgcesum})}),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:a.legendData,textStyle:{color:"#000"},selected:a.selected},series:[{type:"pie",radius:"55%",center:["40%","50%"],label:{show:!1},labelLine:{normal:{show:!1}},data:o.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:t}]})}})})},o.custom(),o.byitem=function(){a.eca.info({projectid:APP.Project[0]._id,type:"BYITEM"},function(e){var t=e.result;o.categoryArray=[],angular.forEach(t,function(e){o.categoryArray.push(e.id)})}).$promise.then(function(){o.ele=function(){a.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,devicetype:["ELECTRICITYMETER","MELECTRICITYMETER"],timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(a){o.data=a.result,angular.forEach(o.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),o.legendData=[],o.selected={},o.seriesData=[],angular.forEach(o.data,function(e){o.legendData.push(e.title),o.selected[e.title]=!0,o.seriesData.push({name:e.title,value:e.kgcesum})}),console.log(o.seriesData),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:a.legendData,textStyle:{color:"#000"},selected:a.selected},series:[{name:"",type:"pie",radius:"55%",center:["40%","50%"],data:o.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:t}]}})},o.ele(),o.water=function(){a.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,devicetype:["COLDWATERMETER","HOTWATERMETER","ULTRACOLDWATERMETER"],timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(a){o.data=a.result,angular.forEach(o.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),o.legendData=[],o.selected={},o.seriesData=[],angular.forEach(o.data,function(e){o.legendData.push(e.title),o.selected[e.title]=!0,o.seriesData.push({name:e.title,value:e.kgcesum})}),e.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:a.legendData,textStyle:{color:"#000"},selected:a.selected},series:[{type:"pie",radius:"55%",center:["40%","50%"],data:o.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:t}]}})}})}})}]}),angular.module("app").component("auditline",{templateUrl:"app/modules/audit/auditline.html?rev=9c4537f29a",bindings:{data:"<",unit:"<",type:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$interval","$timeout",function(e,t,a,r,n){var o=this;e.$watchCollection(function(){return o.data},function(){o.thisYear=(new Date).getFullYear(),o.lastYear=o.thisYear-1,o.beforeLastYear=o.thisYear-2,e.baseConfig={dataLoaded:!0},e.lineConfig=angular.copy(e.baseConfig),a.business.projectYearKGCE({projectid:APP.Project[0]._id},function(t){o.series=t.monthly,e.lineOption={color:["#003366","#006699","#4cabce","#e5323e"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["本年用量","参照用量"]},toolbox:{show:!0,orient:"vertical",left:"right",top:"center",feature:{magicType:{show:!0,type:["line","bar"]},saveAsImage:{show:!0}}},calculable:!0,grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",axisTick:{show:!1},data:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}],yAxis:[{type:"value"}],series:[{name:"本年用量",type:"bar",barGap:0,data:[123,1231,3243,2343,2345,6435,324,5234,235]},{name:"参照用量",type:"bar",data:o.series}]}})})}]});