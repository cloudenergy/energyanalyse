angular.module("app").component("main",{templateUrl:"app/modules/main/main.html?rev=2c601931f1",controller:["$api","$q","$interval","$state",function(t,E,a,e){function o(t){var E=new Date;E.setDate(E.getDate()+t);var a=E.getFullYear(),e=E.getMonth()+1,o=E.getDate();return String(a)+String(e<10&&"0"+e||e)+String(o)}var s=this;s.groupmode=!1,s.selectDay=moment().format("YYYYMMDD"),s.selectMonth=moment().format("YYYYMM"),s.projectName=APP.Project[0].title||s.projectName,s.projectid=APP.Project[0]._id,s.today=o(0),s.yesterday=o(-1),s.thisMonth=(new Date).toLocaleString().split(" ")[0].split("/")[0]+(1==(new Date).toLocaleString().split(" ")[0].split("/")[1].length&&"0"+(new Date).toLocaleString().split(" ")[0].split("/")[1]||(new Date).toLocaleString().split(" ")[0].split("/")[1])+"01",s.lastMonthStart=String((new Date).getFullYear())+(1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+"01",s.lastMonthEnd=String((new Date).getFullYear())+(1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String(new Date((new Date).getFullYear(),(new Date).getMonth(),0).getDate()),s.year=String((new Date).getFullYear())+"0101",s.COLDWATERMETER={},s.ELECTRICITYMETER={},s.HEATENERGYMETER={},s.ENERGYMETER={},t.eca.info({projectid:s.projectid,type:"BYCATEGORY"},function(t){var E=t.result;s.categoryArray=[],angular.forEach(E,function(t){s.categoryArray.push(t.id)})}).$promise.finally(function(){var o=[];o.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.today,timeto:s.today,timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.today=t.data.usagesum,s.COLDWATERMETER.todaycost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.today=t.data.usagesum,s.ELECTRICITYMETER.todaycost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.today=t.data.usagesum,s.HEATENERGYMETER.todaycost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.today=t.data.usagesum,s.ENERGYMETER.todaycost=t.data.costsum)})}).$promise),o.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.yesterday,timeto:s.yesterday,timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.yesterday=t.data.usagesum,s.COLDWATERMETER.yesterdaycost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.yesterday=t.data.usagesum,s.ELECTRICITYMETER.yesterdaycost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.yesterday=t.data.usagesum,s.HEATENERGYMETER.yesterdaycost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.yesterday=t.data.usagesum,s.ENERGYMETER.yesterdaycost=t.data.costsum)})}).$promise),o.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.thisMonth,timeto:s.today,timetype:"MONTH"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.thisMonth=t.data.usagesum,s.COLDWATERMETER.thisMonthcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.thisMonth=t.data.usagesum,s.ELECTRICITYMETER.thisMonthcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.thisMonth=t.data.usagesum,s.HEATENERGYMETER.thisMonthcost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.thisMonth=t.data.usagesum,s.ENERGYMETER.thisMonthcost=t.data.costsum)})}).$promise),o.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.lastMonthStart,timeto:s.lastMonthEnd,timetype:"MONTH"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.lastMonth=t.data.usagesum,s.COLDWATERMETER.lastMonthcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.lastMonth=t.data.usagesum,s.ELECTRICITYMETER.lastMonthcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.lastMonth=t.data.usagesum,s.HEATENERGYMETER.lastMonthcost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.lastMonth=t.data.usagesum,s.ENERGYMETER.lastMonthcost=t.data.costsum)})}).$promise),o.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.year,timeto:s.today,timetype:"YEAR"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.year=t.data.usagesum,s.COLDWATERMETER.yearcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.year=t.data.usagesum,s.ELECTRICITYMETER.yearcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.year=t.data.usagesum,s.HEATENERGYMETER.yearcost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.year=t.data.usagesum,s.ENERGYMETER.yearcost=t.data.costsum)})}).$promise),E.all(o).then(function(){s.coldhot={},s.fee={},s.coldhot.today=new BigDecimal(String(s.HEATENERGYMETER.today||0)).add(new BigDecimal(String(s.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.yesterday=new BigDecimal(String(s.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(s.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.thisMonth=new BigDecimal(String(s.HEATENERGYMETER.thisMonth||0)).add(new BigDecimal(String(s.ENERGYMETER.thisMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.lastMonth=new BigDecimal(String(s.HEATENERGYMETER.lastMonth||0)).add(new BigDecimal(String(s.ENERGYMETER.lastMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.year=new BigDecimal(String(s.HEATENERGYMETER.year||0)).add(new BigDecimal(String(s.ENERGYMETER.year||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.today=new BigDecimal(String(s.COLDWATERMETER.todaycost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.todaycost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.todaycost||0))).add(new BigDecimal(String(s.ENERGYMETER.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.yesterdaycost=new BigDecimal(String(s.COLDWATERMETER.yesterdaycost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.yesterdaycost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.yesterdaycost||0))).add(new BigDecimal(String(s.ENERGYMETER.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.thisMonthcost=new BigDecimal(String(s.COLDWATERMETER.thisMonthcost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.thisMonthcost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.thisMonthcost||0))).add(new BigDecimal(String(s.ENERGYMETER.thisMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.lastMonthcost=new BigDecimal(String(s.COLDWATERMETER.lastMonthcost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.lastMonthcost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.lastMonthcost||0))).add(new BigDecimal(String(s.ENERGYMETER.lastMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.yearcost=new BigDecimal(String(s.COLDWATERMETER.yearcost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.yearcost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.yearcost||0))).add(new BigDecimal(String(s.ENERGYMETER.yearcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()});var n=a(function(){var a=[];a.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.today,timeto:s.today,timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.today=t.data.usagesum,s.COLDWATERMETER.todaycost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.today=t.data.usagesum,s.ELECTRICITYMETER.todaycost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.today=t.data.usagesum,s.HEATENERGYMETER.todaycost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.today=t.data.usagesum,s.ENERGYMETER.todaycost=t.data.costsum)})}).$promise),a.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.yesterday,timeto:s.yesterday,timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.yesterday=t.data.usagesum,s.COLDWATERMETER.yesterdaycost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.yesterday=t.data.usagesum,s.ELECTRICITYMETER.yesterdaycost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.yesterday=t.data.usagesum,s.HEATENERGYMETER.yesterdaycost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.yesterday=t.data.usagesum,s.ENERGYMETER.yesterdaycost=t.data.costsum)})}).$promise),a.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.thisMonth,timeto:s.today,timetype:"MONTH"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.thisMonth=t.data.usagesum,s.COLDWATERMETER.thisMonthcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.thisMonth=t.data.usagesum,s.ELECTRICITYMETER.thisMonthcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.thisMonth=t.data.usagesum,s.HEATENERGYMETER.thisMonthcost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.thisMonth=t.data.usagesum,s.ENERGYMETER.thisMonthcost=t.data.costsum)})}).$promise),a.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.lastMonthStart,timeto:s.lastMonthEnd,timetype:"MONTH"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.lastMonth=t.data.usagesum,s.COLDWATERMETER.lastMonthcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.lastMonth=t.data.usagesum,s.ELECTRICITYMETER.lastMonthcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.lastMonth=t.data.usagesum,s.HEATENERGYMETER.lastMonthcost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.lastMonth=t.data.usagesum,s.ENERGYMETER.lastMonthcost=t.data.costsum)})}).$promise),a.push(t.eca.analysis({nodes:s.categoryArray,projectid:s.projectid,timefrom:s.year,timeto:s.today,timetype:"YEAR"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(s.COLDWATERMETER.year=t.data.usagesum,s.COLDWATERMETER.yearcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(s.ELECTRICITYMETER.year=t.data.usagesum,s.ELECTRICITYMETER.yearcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(s.HEATENERGYMETER.year=t.data.usagesum,s.HEATENERGYMETER.yearcost=t.data.costsum),"ENERGYMETER"==t.category&&(s.ENERGYMETER.year=t.data.usagesum,s.ENERGYMETER.yearcost=t.data.costsum)})}).$promise),E.all(a).then(function(){s.coldhot={},s.fee={},s.coldhot.today=new BigDecimal(String(s.HEATENERGYMETER.today||0)).add(new BigDecimal(String(s.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.yesterday=new BigDecimal(String(s.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(s.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.thisMonth=new BigDecimal(String(s.HEATENERGYMETER.thisMonth||0)).add(new BigDecimal(String(s.ENERGYMETER.thisMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.lastMonth=new BigDecimal(String(s.HEATENERGYMETER.lastMonth||0)).add(new BigDecimal(String(s.ENERGYMETER.lastMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.year=new BigDecimal(String(s.HEATENERGYMETER.year||0)).add(new BigDecimal(String(s.ENERGYMETER.year||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.today=new BigDecimal(String(s.COLDWATERMETER.todaycost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.todaycost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.todaycost||0))).add(new BigDecimal(String(s.ENERGYMETER.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.yesterdaycost=new BigDecimal(String(s.COLDWATERMETER.yesterdaycost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.yesterdaycost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.yesterdaycost||0))).add(new BigDecimal(String(s.ENERGYMETER.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.thisMonthcost=new BigDecimal(String(s.COLDWATERMETER.thisMonthcost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.thisMonthcost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.thisMonthcost||0))).add(new BigDecimal(String(s.ENERGYMETER.thisMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.lastMonthcost=new BigDecimal(String(s.COLDWATERMETER.lastMonthcost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.lastMonthcost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.lastMonthcost||0))).add(new BigDecimal(String(s.ENERGYMETER.lastMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.fee.yearcost=new BigDecimal(String(s.COLDWATERMETER.yearcost||0)).add(new BigDecimal(String(s.ELECTRICITYMETER.yearcost||0))).add(new BigDecimal(String(s.HEATENERGYMETER.yearcost||0))).add(new BigDecimal(String(s.ENERGYMETER.yearcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()})},6e5);$scope.$on("$stateChangeSuccess",function(t,E,o,R,i){s.dashboard="/main"==e.current.url,!s.dashboard&&a.cancel(n)||n()})})}]});