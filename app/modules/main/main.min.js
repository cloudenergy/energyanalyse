angular.module("app").component("main",{templateUrl:"app/modules/main/main.html?rev=440a1cf73c",controller:["$api","$q","$interval",function(t,E,a){function e(t){var E=new Date;E.setDate(E.getDate()+t);var a=E.getFullYear(),e=E.getMonth()+1,o=E.getDate();return String(a)+String(e<10&&"0"+e||e)+String(o)}$("body").css("background","url(/app/img/main-bg.png?rev=be3b49864e) no-repeat center center");var o=this;o.groupmode=!1,o.selectDay=moment().format("YYYYMMDD"),o.selectMonth=moment().format("YYYYMM"),o.projectName=APP.Project[0].title||o.projectName,o.projectid=APP.Project[0]._id,o.today=e(0),o.yesterday=e(-1),o.thisMonth=(new Date).toLocaleString().split(" ")[0].split("/")[0]+(1==(new Date).toLocaleString().split(" ")[0].split("/")[1].length&&"0"+(new Date).toLocaleString().split(" ")[0].split("/")[1]||(new Date).toLocaleString().split(" ")[0].split("/")[1])+"01",o.lastMonthStart=String((new Date).getFullYear())+(1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+"01",o.lastMonthEnd=String((new Date).getFullYear())+(1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String(new Date((new Date).getFullYear(),(new Date).getMonth(),0).getDate()),o.year=String((new Date).getFullYear())+"0101",o.COLDWATERMETER={},o.ELECTRICITYMETER={},o.HEATENERGYMETER={},o.ENERGYMETER={},t.eca.info({projectid:o.projectid,type:"BYCATEGORY"},function(t){var E=t.result;o.categoryArray=[],angular.forEach(E,function(t){o.categoryArray.push(t.id)})}).$promise.finally(function(){var e=[];e.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.today,timeto:o.today,timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.today=t.data.usagesum,o.COLDWATERMETER.todaycost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.today=t.data.usagesum,o.ELECTRICITYMETER.todaycost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.today=t.data.usagesum,o.HEATENERGYMETER.todaycost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.today=t.data.usagesum,o.ENERGYMETER.todaycost=t.data.costsum)})}).$promise),e.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.yesterday,timeto:o.yesterday,timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.yesterday=t.data.usagesum,o.COLDWATERMETER.yesterdaycost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.yesterday=t.data.usagesum,o.ELECTRICITYMETER.yesterdaycost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.yesterday=t.data.usagesum,o.HEATENERGYMETER.yesterdaycost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.yesterday=t.data.usagesum,o.ENERGYMETER.yesterdaycost=t.data.costsum)})}).$promise),e.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.thisMonth,timeto:o.today,timetype:"MONTH"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.thisMonth=t.data.usagesum,o.COLDWATERMETER.thisMonthcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.thisMonth=t.data.usagesum,o.ELECTRICITYMETER.thisMonthcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.thisMonth=t.data.usagesum,o.HEATENERGYMETER.thisMonthcost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.thisMonth=t.data.usagesum,o.ENERGYMETER.thisMonthcost=t.data.costsum)})}).$promise),e.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.lastMonthStart,timeto:o.lastMonthEnd,timetype:"MONTH"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.lastMonth=t.data.usagesum,o.COLDWATERMETER.lastMonthcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.lastMonth=t.data.usagesum,o.ELECTRICITYMETER.lastMonthcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.lastMonth=t.data.usagesum,o.HEATENERGYMETER.lastMonthcost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.lastMonth=t.data.usagesum,o.ENERGYMETER.lastMonthcost=t.data.costsum)})}).$promise),e.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.year,timeto:o.today,timetype:"YEAR"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.year=t.data.usagesum,o.COLDWATERMETER.yearcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.year=t.data.usagesum,o.ELECTRICITYMETER.yearcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.year=t.data.usagesum,o.HEATENERGYMETER.yearcost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.year=t.data.usagesum,o.ENERGYMETER.yearcost=t.data.costsum)})}).$promise),E.all(e).then(function(){o.coldhot={},o.fee={},o.coldhot.today=new BigDecimal(String(o.HEATENERGYMETER.today||0)).add(new BigDecimal(String(o.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.yesterday=new BigDecimal(String(o.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(o.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.thisMonth=new BigDecimal(String(o.HEATENERGYMETER.thisMonth||0)).add(new BigDecimal(String(o.ENERGYMETER.thisMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.lastMonth=new BigDecimal(String(o.HEATENERGYMETER.lastMonth||0)).add(new BigDecimal(String(o.ENERGYMETER.lastMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.year=new BigDecimal(String(o.HEATENERGYMETER.year||0)).add(new BigDecimal(String(o.ENERGYMETER.year||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.today=new BigDecimal(String(o.COLDWATERMETER.todaycost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.todaycost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.todaycost||0))).add(new BigDecimal(String(o.ENERGYMETER.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.yesterdaycost=new BigDecimal(String(o.COLDWATERMETER.yesterdaycost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.yesterdaycost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.yesterdaycost||0))).add(new BigDecimal(String(o.ENERGYMETER.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.thisMonthcost=new BigDecimal(String(o.COLDWATERMETER.thisMonthcost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.thisMonthcost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.thisMonthcost||0))).add(new BigDecimal(String(o.ENERGYMETER.thisMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.lastMonthcost=new BigDecimal(String(o.COLDWATERMETER.lastMonthcost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.lastMonthcost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.lastMonthcost||0))).add(new BigDecimal(String(o.ENERGYMETER.lastMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.yearcost=new BigDecimal(String(o.COLDWATERMETER.yearcost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.yearcost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.yearcost||0))).add(new BigDecimal(String(o.ENERGYMETER.yearcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()});a(function(){var a=[];a.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.today,timeto:o.today,timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.today=t.data.usagesum,o.COLDWATERMETER.todaycost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.today=t.data.usagesum,o.ELECTRICITYMETER.todaycost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.today=t.data.usagesum,o.HEATENERGYMETER.todaycost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.today=t.data.usagesum,o.ENERGYMETER.todaycost=t.data.costsum)})}).$promise),a.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.yesterday,timeto:o.yesterday,timetype:"DAY"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.yesterday=t.data.usagesum,o.COLDWATERMETER.yesterdaycost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.yesterday=t.data.usagesum,o.ELECTRICITYMETER.yesterdaycost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.yesterday=t.data.usagesum,o.HEATENERGYMETER.yesterdaycost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.yesterday=t.data.usagesum,o.ENERGYMETER.yesterdaycost=t.data.costsum)})}).$promise),a.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.thisMonth,timeto:o.today,timetype:"MONTH"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.thisMonth=t.data.usagesum,o.COLDWATERMETER.thisMonthcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.thisMonth=t.data.usagesum,o.ELECTRICITYMETER.thisMonthcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.thisMonth=t.data.usagesum,o.HEATENERGYMETER.thisMonthcost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.thisMonth=t.data.usagesum,o.ENERGYMETER.thisMonthcost=t.data.costsum)})}).$promise),a.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.lastMonthStart,timeto:o.lastMonthEnd,timetype:"MONTH"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.lastMonth=t.data.usagesum,o.COLDWATERMETER.lastMonthcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.lastMonth=t.data.usagesum,o.ELECTRICITYMETER.lastMonthcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.lastMonth=t.data.usagesum,o.HEATENERGYMETER.lastMonthcost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.lastMonth=t.data.usagesum,o.ENERGYMETER.lastMonthcost=t.data.costsum)})}).$promise),a.push(t.eca.analysis({nodes:o.categoryArray,projectid:o.projectid,timefrom:o.year,timeto:o.today,timetype:"YEAR"},function(t){angular.forEach(t.result,function(t){"COLDWATERMETER"==t.category&&(o.COLDWATERMETER.year=t.data.usagesum,o.COLDWATERMETER.yearcost=t.data.costsum),"ELECTRICITYMETER"==t.category&&(o.ELECTRICITYMETER.year=t.data.usagesum,o.ELECTRICITYMETER.yearcost=t.data.costsum),"HEATENERGYMETER"==t.category&&(o.HEATENERGYMETER.year=t.data.usagesum,o.HEATENERGYMETER.yearcost=t.data.costsum),"ENERGYMETER"==t.category&&(o.ENERGYMETER.year=t.data.usagesum,o.ENERGYMETER.yearcost=t.data.costsum)})}).$promise),E.all(a).then(function(){o.coldhot={},o.fee={},o.coldhot.today=new BigDecimal(String(o.HEATENERGYMETER.today||0)).add(new BigDecimal(String(o.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.yesterday=new BigDecimal(String(o.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(o.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.thisMonth=new BigDecimal(String(o.HEATENERGYMETER.thisMonth||0)).add(new BigDecimal(String(o.ENERGYMETER.thisMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.lastMonth=new BigDecimal(String(o.HEATENERGYMETER.lastMonth||0)).add(new BigDecimal(String(o.ENERGYMETER.lastMonth||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.year=new BigDecimal(String(o.HEATENERGYMETER.year||0)).add(new BigDecimal(String(o.ENERGYMETER.year||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.today=new BigDecimal(String(o.COLDWATERMETER.todaycost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.todaycost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.todaycost||0))).add(new BigDecimal(String(o.ENERGYMETER.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.yesterdaycost=new BigDecimal(String(o.COLDWATERMETER.yesterdaycost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.yesterdaycost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.yesterdaycost||0))).add(new BigDecimal(String(o.ENERGYMETER.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.thisMonthcost=new BigDecimal(String(o.COLDWATERMETER.thisMonthcost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.thisMonthcost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.thisMonthcost||0))).add(new BigDecimal(String(o.ENERGYMETER.thisMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.lastMonthcost=new BigDecimal(String(o.COLDWATERMETER.lastMonthcost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.lastMonthcost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.lastMonthcost||0))).add(new BigDecimal(String(o.ENERGYMETER.lastMonthcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.fee.yearcost=new BigDecimal(String(o.COLDWATERMETER.yearcost||0)).add(new BigDecimal(String(o.ELECTRICITYMETER.yearcost||0))).add(new BigDecimal(String(o.HEATENERGYMETER.yearcost||0))).add(new BigDecimal(String(o.ENERGYMETER.yearcost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()})},6e5)})}]});