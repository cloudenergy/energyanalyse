angular.module("app").component("map",{templateUrl:"app/modules/map/map.html?rev=130c31cdf3",controller:["$api","$q","$rootScope",function(e,a,t){function E(e){var a=new Date;a.setDate(a.getDate()+e);var t=a.getFullYear(),E=a.getMonth()+1,o=a.getDate();return String(t)+String(E<10&&"0"+E||E)+String(o)}var o=this,y=E(0),r=E(-1),s=E(-2);o.showdata=function(){o.showdetail=!o.showdetail},o.showchart,e.eca.info({projectid:APP.Project[0]._id,type:"BYCATEGORY"},function(e){var a=e.result;o.categoryArray=[],angular.forEach(a,function(e){o.categoryArray.push(e.id)})}).$promise.then(function(){var E=[];o.ELECTRICITYMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.COLDWATERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.HOTWATERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.HEATENERGYMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.TEMPERATURECONTROL={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.TIMERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.PRESSUREMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.ULTRACOLDWATERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.DDWATERMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.ENERGYMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.TTYPETEMPCONTROL={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.OXYGENMETER={cost:{today:{},yesterday:{},beforeyesterday:{}},usage:{today:{},yesterday:{},beforeyesterday:{}}},o.category={},E.push(e.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,timefrom:y,timeto:y,detail:!0,timetype:"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(o.ELECTRICITYMETER.usage.today=e.data.usage,o.ELECTRICITYMETER.cost.today=e.data.cost):"COLDWATERMETER"==e.category?(o.COLDWATERMETER.usage.today=e.data.usage,o.COLDWATERMETER.cost.today=e.data.cost):"HOTWATERMETER"==e.category?(o.HOTWATERMETER.usage.today=e.data.usage,o.HOTWATERMETER.cost.today=e.data.cost):"HEATENERGYMETER"==e.category?(o.HEATENERGYMETER.usage.today=e.data.usage,o.HEATENERGYMETER.cost.today=e.data.cost):"TEMPERATURECONTROL"==e.category?(o.TEMPERATURECONTROL.usage.today=e.data.usage,o.TEMPERATURECONTROL.cost.today=e.data.cost):"TIMERMETER"==e.category?(o.TIMERMETER.usage.today=e.data.usage,o.TIMERMETER.cost.today=e.data.cost):"PRESSUREMETER"==e.category?(o.PRESSUREMETER.usage.today=e.data.usage,o.PRESSUREMETER.cost.today=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(o.ULTRACOLDWATERMETER.usage.today=e.data.usage,o.ULTRACOLDWATERMETER.cost.today=e.data.cost):"DDWATERMETER"==e.category?(o.DDWATERMETER.usage.today=e.data.usage,o.DDWATERMETER.cost.today=e.data.cost):"ENERGYMETER"==e.category?(o.ENERGYMETER.usage.today=e.data.usage,o.ENERGYMETER.cost.today=e.data.cost):"TTYPETEMPCONTROL"==e.category?(o.TTYPETEMPCONTROL.usage.today=e.data.usage,o.TTYPETEMPCONTROL.cost.today=e.data.cost):"OXYGENMETER"==e.category&&(o.OXYGENMETER.usage.today=e.data.usage,o.OXYGENMETER.cost.today=e.data.cost),!o.category[e.category]&&(o.category[e.category]={}),o.category[e.category].today=e.data.usagesum,o.category[e.category].todaycost=e.data.costsum})}).$promise),E.push(e.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,timefrom:r,timeto:r,detail:!0,timetype:"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(o.ELECTRICITYMETER.usage.yesterday=e.data.usage,o.ELECTRICITYMETER.cost.yesterday=e.data.cost):"COLDWATERMETER"==e.category?(o.COLDWATERMETER.usage.yesterday=e.data.usage,o.COLDWATERMETER.cost.yesterday=e.data.cost):"HOTWATERMETER"==e.category?(o.HOTWATERMETER.usage.yesterday=e.data.usage,o.HOTWATERMETER.cost.yesterday=e.data.cost):"HEATENERGYMETER"==e.category?(o.HEATENERGYMETER.usage.yesterday=e.data.usage,o.HEATENERGYMETER.cost.yesterday=e.data.cost):"TEMPERATURECONTROL"==e.category?(o.TEMPERATURECONTROL.usage.yesterday=e.data.usage,o.TEMPERATURECONTROL.cost.yesterday=e.data.cost):"TIMERMETER"==e.category?(o.TIMERMETER.usage.yesterday=e.data.usage,o.TIMERMETER.cost.yesterday=e.data.cost):"PRESSUREMETER"==e.category?(o.PRESSUREMETER.usage.yesterday=e.data.usage,o.PRESSUREMETER.cost.yesterday=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(o.ULTRACOLDWATERMETER.usage.yesterday=e.data.usage,o.ULTRACOLDWATERMETER.cost.yesterday=e.data.cost):"DDWATERMETER"==e.category?(o.DDWATERMETER.usage.yesterday=e.data.usage,o.DDWATERMETER.cost.yesterday=e.data.cost):"ENERGYMETER"==e.category?(o.ENERGYMETER.usage.yesterday=e.data.usage,o.ENERGYMETER.cost.yesterday=e.data.cost):"TTYPETEMPCONTROL"==e.category?(o.TTYPETEMPCONTROL.usage.yesterday=e.data.usage,o.TTYPETEMPCONTROL.cost.yesterday=e.data.cost):"OXYGENMETER"==e.category&&(o.OXYGENMETER.usage.yesterday=e.data.usage,o.OXYGENMETER.cost.yesterday=e.data.cost),!o.category[e.category]&&(o.category[e.category]={}),o.category[e.category].yesterday=e.data.usagesum,o.category[e.category].yesterdaycost=e.data.costsum})}).$promise),E.push(e.eca.analysis({nodes:o.categoryArray,projectid:APP.Project[0]._id,timefrom:s,timeto:s,detail:!0,timetype:"DAY"},function(e){angular.forEach(e.result,function(e){"ELECTRICITYMETER"==e.category?(o.ELECTRICITYMETER.usage.beforeyesterday=e.data.usage,o.ELECTRICITYMETER.cost.beforeyesterday=e.data.cost):"COLDWATERMETER"==e.category?(o.COLDWATERMETER.usage.beforeyesterday=e.data.usage,o.COLDWATERMETER.cost.beforeyesterday=e.data.cost):"HOTWATERMETER"==e.category?(o.HOTWATERMETER.usage.beforeyesterday=e.data.usage,o.HOTWATERMETER.cost.beforeyesterday=e.data.cost):"HEATENERGYMETER"==e.category?(o.HEATENERGYMETER.usage.beforeyesterday=e.data.usage,o.HEATENERGYMETER.cost.beforeyesterday=e.data.cost):"TEMPERATURECONTROL"==e.category?(o.TEMPERATURECONTROL.usage.beforeyesterday=e.data.usage,o.TEMPERATURECONTROL.cost.beforeyesterday=e.data.cost):"TIMERMETER"==e.category?(o.TIMERMETER.usage.beforeyesterday=e.data.usage,o.TIMERMETER.cost.beforeyesterday=e.data.cost):"PRESSUREMETER"==e.category?(o.PRESSUREMETER.usage.beforeyesterday=e.data.usage,o.PRESSUREMETER.cost.beforeyesterday=e.data.cost):"ULTRACOLDWATERMETER"==e.category?(o.ULTRACOLDWATERMETER.usage.beforeyesterday=e.data.usage,o.ULTRACOLDWATERMETER.cost.beforeyesterday=e.data.cost):"DDWATERMETER"==e.category?(o.DDWATERMETER.usage.beforeyesterday=e.data.usage,o.DDWATERMETER.cost.beforeyesterday=e.data.cost):"ENERGYMETER"==e.category?(o.ENERGYMETER.usage.beforeyesterday=e.data.usage,o.ENERGYMETER.cost.beforeyesterday=e.data.cost):"TTYPETEMPCONTROL"==e.category?(o.TTYPETEMPCONTROL.usage.beforeyesterday=e.data.usage,o.TTYPETEMPCONTROL.cost.beforeyesterday=e.data.cost):"OXYGENMETER"==e.category&&(o.OXYGENMETER.usage.beforeyesterday=e.data.usage,o.OXYGENMETER.cost.beforeyesterday=e.data.cost),!o.category[e.category]&&(o.category[e.category]={}),o.category[e.category].beforeyesterday=e.data.usagesum,o.category[e.category].beforeyesterdaycost=e.data.costsum})}).$promise),a.all(E).then(function(){o.chartdata=o.ELECTRICITYMETER.usage,o.unit="kwh",o.chartTitle="耗电量",o.coldhot={},o.hotcloddata={usage:{today:{},yesterday:{},beforeyesterday:{}},cost:{today:{},yesterday:{},beforeyesterday:{}}},o.fee={today:{},yesterday:{},beforeyesterday:{}},angular.forEach(o.category,function(e){o.todaycost=new BigDecimal(String(e.todaycost)).add(new BigDecimal(String(o.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.yesterdaycost=new BigDecimal(String(e.yesterdaycost)).add(new BigDecimal(String(o.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.beforeyesterdaycost=new BigDecimal(String(e.beforeyesterdaycost)).add(new BigDecimal(String(o.beforeyesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.today=new BigDecimal(String(o.category.HEATENERGYMETER&&o.category.HEATENERGYMETER.today||0)).add(new BigDecimal(String(o.category.ENERGYMETER&&o.category.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.yesterday=new BigDecimal(String(o.category.HEATENERGYMETER&&o.category.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(o.category.ENERGYMETER&&o.category.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),o.coldhot.beforeyesterday=new BigDecimal(String(o.category.HEATENERGYMETER&&o.category.HEATENERGYMETER.beforeyesterday||0)).add(new BigDecimal(String(o.category.ENERGYMETER&&o.category.ENERGYMETER.beforeyesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()}),angular.forEach(!angular.equals({},o.TIMERMETER.usage.today)&&o.TIMERMETER.usage||!angular.equals({},o.HEATENERGYMETER.usage.today)&&o.HEATENERGYMETER.usage||!angular.equals({},o.ENERGYMETER.usage.today)&&o.ENERGYMETER.usage,function(e,a){"beforeyesterday"==a&&angular.forEach(e,function(e,a){o.hotcloddata.usage.beforeyesterday[a]={},o.hotcloddata.usage.beforeyesterday[a].timepoint=Number(a),o.hotcloddata.usage.beforeyesterday[a].value=Number(new BigDecimal(String(!angular.equals({},o.TIMERMETER.usage.beforeyesterday)&&o.TIMERMETER.usage.beforeyesterday[a].value||0)).add(new BigDecimal(String(!angular.equals({},o.HEATENERGYMETER.usage.beforeyesterday)&&o.HEATENERGYMETER.usage.beforeyesterday[a].value||0))).add(new BigDecimal(String(!angular.equals({},o.ENERGYMETER.usage.beforeyesterday)&&o.ENERGYMETER.usage.beforeyesterday[a].value||0))).setScale(2,MathContext.ROUND_HALF_UP).toString())})}),angular.forEach(o,function(e){angular.equals({},e.cost)||angular.forEach(e.cost,function(e,a){"today"==a&&angular.forEach(e,function(e,a){!o.fee.today[a]&&(o.fee.today[a]={}),o.fee.today[a].timepoint=Number(a),o.fee.today[a].value=Number(new BigDecimal(String(o.fee.today[a].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"yesterday"==a&&angular.forEach(e,function(e,a){!o.fee.yesterday[a]&&(o.fee.yesterday[a]={}),o.fee.yesterday[a].timepoint=Number(a),o.fee.yesterday[a].value=Number(new BigDecimal(String(o.fee.yesterday[a].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"beforeyesterday"==a&&angular.forEach(e,function(e,a){!o.fee.beforeyesterday[a]&&(o.fee.beforeyesterday[a]={}),o.fee.beforeyesterday[a].timepoint=Number(a),o.fee.beforeyesterday[a].value=Number(new BigDecimal(String(o.fee.beforeyesterday[a].value||0)).add(new BigDecimal(String(e.cost))).toString())})})}),t.tips={todayELECTRICITYMETER:o.category.ELECTRICITYMETER.today,yesterdayELECTRICITYMETER:o.category.ELECTRICITYMETER.yesterday,beforeyesterdayELECTRICITYMETER:o.category.ELECTRICITYMETER.beforeyesterday,todayCOLDWATERMETER:o.category.COLDWATERMETER.today,yesterdayCOLDWATERMETER:o.category.COLDWATERMETER.yesterday,beforeyesterdayCOLDWATERMETER:o.category.COLDWATERMETER.beforeyesterday,todaycoldhot:o.coldhot.today,yesterdaycoldhot:o.coldhot.today.yesterday,beforeyesterdaycoldhot:o.coldhot.today.beforeyesterday,todaycost:o.todaycost,yesterdaycost:o.yesterdaycost,beforeyesterdaycost:o.beforeyesterdaycost}})})}]}),angular.module("app").component("mapele",{templateUrl:"app/modules/map/mapele.html?rev=6c57bc7e33",bindings:{showchart:"=",data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api",function(e,a,t){var E=this;e.$watchCollection(function(){return E.data},function(e){var a=[],t=[];E.charttype="column",angular.forEach(E.data,function(e,o,y){E.key=o,Object.keys(e).length>a.length&&(y=0,a=[]),angular.forEach(e,function(e){this.push(e.value),0===y&&a.push(parseInt(e.timepoint))},e=[]),t.push({data:e,name:"today"==o&&"今日"||"yesterday"==o&&"昨日"||"beforeyesterday"==o&&"前日"||"thisMonth"==o&&"本月"||"lastMonth"==o&&"上月"||"beforelastMonth"==o&&"前月"||"year"==o&&"本年"||"lastYear"==o&&"去年"||"beforelastYear"==o&&"前年"})}),E.typeChange=function(e){e&&(E.charttype=e),E.energyconstitute={chart:{type:E.charttype,backgroundColor:"rgba(0, 0, 0, 0)"},title:!1,xAxis:{categories:a,labels:{formatter:function(){return"today"==E.key||"yesterday"==E.key||"beforeyesterday"==E.key?moment(this.value).hour():"thisMonth"==E.key||"lastMonth"==E.key||"beforelastMonth"==E.key?moment(this.value).date():"year"==E.key||"lastYear"==E.key||"beforelastYear"==E.key?moment(this.value).month()+1:void 0},style:{color:"#000"}}},yAxis:{title:!1,labels:{style:{color:"#000"}}},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y} '+E.unit+"</span>"},series:t}},E.typeChange()})}]});