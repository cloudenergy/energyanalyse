window.APIORIGIN=location.origin.replace("nbgc.","api.").replace(/http:\/\/energy./,"http://api."),angular.module("app").constant("APICONFIG",{auth:["auth",,{login:{},logout:{}}],project:["project",,{auditParameter:{},info:{}}],business:["business",,{userinfo:{},dailyusage:{},calendar:{cache:!0},dailycost:{},monthlykgce:{},energyconstitute:{},dailysensordetail:{},projectYearKGCE:{},energyeffectiverate:{},projectdetail:{},monitor:{},channeldetail:{},buildingstatistic:{},energyincomerate:{},energytimeline:{},socitystatistic:{},socitydetail:{},socitytimeline:{},groupanalysis:{},settlereport:{},monthlyreport:{},dailyreport:{},projectreport:{},recentchargelog:{},departments:{},departmentusage:{},departmentreport:{}}],import:["import",,{auditParameter:{}}],energy:["energy",,{info:{cache:!0}}],control:["control",,{send:{},through:{}}],device:["device",,{type:{cache:!0}}],message:["message",,{remindrecharge:{}}],customer:["customer",,{info:{}}],eca:["eca",,{analysis:{},update:{},info:{}}],energycategory:["energycategory",,{info:{}}],billingservice:["billingservice",,{info:{}}],weather:["weather",,{info:{},recent:{}}]}).config(["$qProvider","$httpProvider",function(e,r){e.errorOnUnhandledRejections(!1),r.interceptors.push(["$rootScope","$q","$location","$timeout",function(e,r,t,a){function n(r,t){t?(angular.isObject(r.params)&&(r._inprogress=r.params._inprogress,delete r.params._inprogress),angular.isObject(r.data)&&angular.isUndefined(r._inprogress)&&(r._inprogress=r.data._inprogress,delete r.data._inprogress),!1!==r._inprogress&&(r._inprogress=a(function(){e.HttpInProgress++,r._inprogress=e.HttpInProgress},60))):(!1!==r._inprogress&&(angular.isNumber(r._inprogress)?a(function(){e.HttpInProgress--},60):angular.isObject(r._inprogress)&&a.cancel(r._inprogress)),delete r._inprogress)}return e.HttpInProgress=0,{request:function(e){return n(e,!0),e},requestError:function(e){return r.reject(e)},response:function(e){return n(e.config,!1),angular.isObject(e.data)&&(e.data.code||e.data.result&&angular.isObject(e.data.result)&&!Object.keys(e.data.result).length)?(/90000005|90000007/.test(e.data.code)&&t.url("/dashboard/login").replace(),r.reject(e.data)):e},responseError:function(e){return n(e.config,!1),r.reject(e.data||{code:e.status})}}}])}]).service("$api",["$rootScope","$resource","APICONFIG",function(e,r,t){var a=function(e,r){return/(^http:\/\/)|(^https:\/\/)/.test(e)&&e||[window.APIORIGIN+"/api/"+e,r&&"/:_api_action"||""].join("")},n=[];e.$on("$stateChangeStart",function(){angular.forEach(n,function(e){!e.$resolved&&e.$cancelRequest()}),n=[]}),angular.forEach(t,function(e,t){angular.isArray(e)&&e[0]&&(e[0]=a(e[0],!!e[2]),e[3]=angular.extend({cancellable:!0},e[3]),angular.forEach(e[2],function(e,r){angular.extend(e,{url:e.url&&a(e.url)||void 0,method:e.method||"POST",withCredentials:!0,params:angular.extend(e.url&&{}||{_api_action:r},e.params)})}),angular.forEach(this[t]=r.apply(r,e),function(e,r){this[r]=function(){var r,t;return angular.isObject(arguments[0])&&angular.isDefined(arguments[0]._cancellable)&&(t=arguments[0]._cancellable,delete arguments[0]._cancellable),angular.isObject(arguments[1])&&angular.isDefined(arguments[1]._cancellable)&&(t=arguments[1]._cancellable,delete arguments[1]._cancellable),r=e.apply(this,arguments),!1===t&&delete r.$cancelRequest,r.$cancelRequest&&n.push(r),r}},this[t]))},this)}]);