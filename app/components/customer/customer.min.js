angular.module("app").component("customer",{templateUrl:"app/components/customer/customer.html?rev=90e9ceabf2",bindings:{customerSelected:"="},controller:["$scope","$element","$timeout","$api","$stateParams","$state",function(e,t,c,n,o,a){function r(e,t){for(var c=0;c<e.length;c++)e[c]==t&&(e.splice(c,1),c--);return e}function i(t,c){return l.times=0,l.customerSelected=[],4==t.parents.length?l.level=4:3==t.parents.length?l.level=3:2==t.parents.length&&(l.level=2),!l.parent1.length&&angular.forEach(l.customer.core.data,function(e){var t=e.path&&e.path.split(",").length||"";0==t&&"ROOT"!=e.id?l.parent1.push(e.id):1==t&&l.parent2.push(e.id)}),$("jstree").on("changed.jstree",function(c,n){if(!l.times)if(l.times=1,l.chosen=angular.copy(n.selected),"ROOT"===t.id){var o=[];angular.forEach(l.customer.core.data,function(e){"ROOT"===e.parent&&o.push(e.id)}),l.customerSelected=o,e.$apply()}else{if(4==l.level)angular.forEach(l.parent1,function(e){r(l.chosen,e)}),angular.forEach(l.parent2,function(e){r(l.chosen,e)}),l.customerSelected=l.chosen;else if(3==l.level){var o=[];angular.forEach(l.parent2,function(e){angular.forEach(n.selected,function(t){e==t&&o.push(e)})}),o=o.distinct(),l.customerSelected=o}else if(2==l.level){var o=[];angular.forEach(l.parent1,function(e){angular.forEach(n.selected,function(t){e==t&&o.push(e)})}),o=o.distinct(),l.customerSelected=o}e.$apply()}}),!0}var l=this;l.choice={},l.parent1=[],l.parent2=[],Array.prototype.distinct=function(){var e,t,c=this,n=[],o=c.length;for(e=0;e<o;e++){for(t=e+1;t<o;t++)c[e]===c[t]&&(t=++e);n.push(c[e])}return n},"CUSTOMER"==o.datatype?n.customer.info({project:APP.Project[0]._id},function(e){l.customer={multiple:!0,checkbox:{keep_selected_style:!1},core:{data:[{id:"ROOT",parent:"#",text:"全部",state:{opened:!0},icon:!1,checkbox:!0}]},conditionalselect:i,plugins:["search","conditionalselect","checkbox","changed"]},function e(t,c){angular.forEach(t,function(t,n){t.parent=c,t.text=t.title,Object.keys(t.child).length,t.icon=!1,e(t.child,t.id),l.customer.core.data.push(t)})}(e.result,"ROOT")}):"/monitor"==a.current.url?n.customer.info({project:APP.Project[0]._id},function(e){l.customer={core:{data:[{id:"ROOT",parent:"#",text:"全部",state:{opened:!0,selected:!0},icon:!1}]},conditionalselect:i,plugins:["search","conditionalselect","checkbox","changed"]},function e(t,c){angular.forEach(t,function(t,n){t.parent=c,t.text=t.title,Object.keys(t.child).length,t.icon=!1,e(t.child,t.id),l.customer.core.data.push(t)})}(e.result,"ROOT")}):n.eca.info({projectid:APP.Project[0]._id,type:o.datatype||"BYITEM"},function(e){l.customer={multiple:!0,checkbox:{keep_selected_style:!1},core:{data:[{id:"ROOT",parent:"#",text:"全部",state:{opened:!0},icon:!1}]},conditionalselect:i,plugins:["search","conditionalselect","checkbox","changed"]},function e(t,c){angular.forEach(t,function(t,n){t.parent=c,t.text=t.title,Object.keys(t.child).length,t.icon=!1,e(t.child,t.id),l.customer.core.data.push(t)})}(e.result,"ROOT")})}]});